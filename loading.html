<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI 진단 결과 분석 중...</title>
<style>
  :root{
    --bg:#0d1420;--panel:#121a26;--line:#2a3a55;
    --brand:#6ba7ff;--white:#fff;--muted:#bcd4ff;
  }
  body {
    font-family:"Pretendard","Noto Sans KR",sans-serif;
    background:var(--bg);color:var(--white);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    height:100vh;margin:0;text-align:center;
  }
  h2 {
    color:var(--brand);
    font-size:1.8em;
    margin-bottom:30px;
  }
  .loader {
    width:80%;max-width:420px;height:16px;
    border-radius:10px;background-color:#22324b;
    overflow:hidden;position:relative;margin:0 auto;
  }
  .fill {
    height:100%;width:0%;
    background:linear-gradient(90deg,#5b8cff,#6ba7ff);
    border-radius:10px;transition:width 0.2s linear;
  }
  p {
    margin-top:25px;
    font-size:1.05em;
    color:var(--muted);
  }
</style>
</head>
<body>
  <h2>AI 진단결과를 분석 중입니다...</h2>
  <div class="loader"><div class="fill" id="fill"></div></div>
  <p id="progress">0%</p>

  <script>
    const topic = localStorage.getItem("aiTopic");
    const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");

    // ✅ GPT 분석을 로딩 중에 백그라운드 실행
    fetch("/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic, answers })
    })
    .then(r => r.json())
    .then(data => localStorage.setItem("aiResult", JSON.stringify(data.result || {})))
    .catch(() => localStorage.setItem("aiResult", JSON.stringify({error:"분석 실패"})));

    // ✅ 5초 로딩 애니메이션
    let percent = 0;
    const fill = document.getElementById("fill");
    const progress = document.getElementById("progress");

    const timer = setInterval(() => {
      percent += Math.floor(Math.random() * 5) + 3;
      if (percent >= 100) {
        percent = 100;
        clearInterval(timer);
        setTimeout(() => {
          window.location.href = "result.html";
        }, 800);
      }
      fill.style.width = percent + "%";
      progress.textContent = percent + "%";
    }, 200);
  </script>
</body>
</html>
