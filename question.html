<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ê±´ê°•Â·ìƒí™œ ì§„ë‹¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin:0;
    background:#f5f7fb;
    font-family:'Noto Sans KR',sans-serif;
  }
  .header {
    background:#2563eb;
    color:white;
    font-size:22px;
    text-align:center;
    padding:22px;
    font-weight:700;
  }
  .container {
    max-width:900px;
    margin:30px auto;
    background:white;
    padding:28px;
    border-radius:16px;
    box-shadow:0 5px 20px rgba(0,0,0,0.07);
  }
  h2 {
    color:#1e293b;
    font-size:19px;
    margin-bottom:12px;
  }
  .option {
    background:#f9fafb;
    border:1px solid #cbd5e1;
    border-radius:10px;
    padding:13px 15px;
    margin-bottom:10px;
    cursor:pointer;
    transition:0.2s;
  }
  .option:hover {
    background:#eff6ff;
    border-color:#3b82f6;
  }
  .option.selected {
    background:#dbeafe;
    border-color:#1d4ed8;
  }
  .btn {
    background:#2563eb;
    color:white;
    padding:18px;
    text-align:center;
    border-radius:12px;
    margin-top:20px;
    cursor:pointer;
    font-size:18px;
    font-weight:600;
  }
  .btn:hover {
    background:#1d4ed8;
  }
  @media(max-width:480px){
    .container{padding:20px;margin:15px;}
    .header{font-size:20px;padding:18px;}
    .btn{font-size:17px;}
  }
</style>
</head>

<body>
<div class="header">ë…¸ì„ë¹›í•˜ë£¨ AI ê±´ê°•Â·ìƒí™œ ì§„ë‹¨</div>
<div class="container">
  <h2 id="topicTitle">ì£¼ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
  <div id="questionContainer"></div>
  <div class="btn" onclick="submitSurvey()">ê²°ê³¼ ë³´ê¸°</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const topic = params.get("topic");

document.getElementById("topicTitle").innerText = `ğŸ©º ${topic} ì§„ë‹¨ ì„¤ë¬¸`;

let surveyData = [];
let selectedAnswers = [];

async function loadSurvey() {
  try {
    const res = await fetch("/survey.json");
    const data = await res.json();

    if (!data[topic]) {
      alert("ì´ ì£¼ì œì— ëŒ€í•œ ì„¤ë¬¸ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      return;
    }

    surveyData = data[topic];
    renderQuestions();
  } catch (err) {
    console.error("ì„¤ë¬¸ ë¡œë“œ ì‹¤íŒ¨:", err);
    alert("ì„¤ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }
}

function renderQuestions() {
  const container = document.getElementById("questionContainer");
  container.innerHTML = "";

  surveyData.forEach((q, i) => {
    const div = document.createElement("div");
    div.innerHTML = `<h2>${i + 1}. ${q.question}</h2>`;

    q.options.forEach(opt => {
      const optDiv = document.createElement("div");
      optDiv.className = "option";
      optDiv.innerText = opt;
      optDiv.onclick = () => selectOption(i, opt, optDiv);
      div.appendChild(optDiv);
    });

    container.appendChild(div);
  });
}

function selectOption(questionIndex, optionText, optionDiv) {
  const group = document.querySelectorAll(`#questionContainer div:nth-child(${questionIndex+1}) .option`);
  group.forEach(o => o.classList.remove("selected"));
  optionDiv.classList.add("selected");
  selectedAnswers[questionIndex] = optionText;
}

async function submitSurvey() {
  if (selectedAnswers.length < surveyData.length) {
    alert("ëª¨ë“  ë¬¸í•­ì— ë‹µí•´ì£¼ì„¸ìš”.");
    return;
  }

  const payload = { topic, checks: selectedAnswers };

  try {
    const res = await fetch("/analyze", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    location.href = `/result?payload=${encodeURIComponent(JSON.stringify(data))}`;
  } catch (err) {
    console.error("ê²°ê³¼ ì „ì†¡ ì˜¤ë¥˜:", err);
    alert("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
}

loadSurvey();
</script>
</body>
</html>
