<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ì§„ë‹¨ ê²°ê³¼</title>
<style>
  :root {
    --bg: #0d1420;
    --panel: #121a26;
    --panel2: #182235;
    --line: #2a3a55;
    --brand: #6ba7ff;
    --muted: #9fb1cf;
    --white: #fff;
  }

  body {
    font-family: "Pretendard", "Noto Sans KR", sans-serif;
    background: var(--bg);
    color: var(--white);
    margin: 0;
  }

  .wrap {
    max-width: 1180px;
    margin: 0 auto;
    padding: 40px 50px;
  }

  h1 {
    color: var(--brand);
    margin-bottom: 18px;
  }

  .grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 32px;
  }

  .left,
  .right {
    background: var(--panel2);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 28px;
  }

  h2 {
    color: var(--brand);
    font-size: 1.25em;
    margin-bottom: 10px;
  }

  p {
    color: var(--muted);
    line-height: 1.6em;
    white-space: pre-line;
  }

  canvas {
    width: 100%;
    max-width: 400px;
    height: 230px;
    display: block;
    margin: 0 auto 20px;
  }

  .section {
    margin-bottom: 28px;
  }

  .affiliate-section h3 {
    color: var(--brand);
    font-size: 1.1em;
    margin-top: 14px;
    margin-bottom: 10px;
  }

  .item {
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 14px;
    margin-bottom: 12px;
  }

  .item .name {
    font-weight: 600;
    margin-bottom: 4px;
    color: #cde0ff;
  }

  .item .desc {
    font-size: 0.95em;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .item a {
    color: #7fb4ff;
    text-decoration: none;
    font-size: 0.9em;
  }

  .notice {
    text-align: center;
    font-size: 0.8em;
    color: #8fa0c0;
    margin-top: 20px;
  }

  @media (max-width: 900px) {
    .grid {
      grid-template-columns: 1fr;
    }
    .wrap {
      padding: 25px 20px;
    }
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>AI ì§„ë‹¨ ê²°ê³¼</h1>
    <div class="grid">
      <!-- ì™¼ìª½ -->
      <div class="left">
        <div class="section">
          <canvas id="riskChart"></canvas>
          <p id="riskInfo"></p>
        </div>

        <div class="section">
          <h2>ìƒì„¸ ì§„ë‹¨</h2>
          <p id="diagnosis"></p>
        </div>

        <div class="section">
          <h2>ìš”ì•½</h2>
          <p id="summary"></p>
        </div>

        <div class="section">
          <h2>ì „ë¬¸ê°€ ì˜ê²¬</h2>
          <p id="expert"></p>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ -->
      <div class="right">
        <div class="affiliate-section">
          <h3>ì œíœ´ìƒí’ˆ</h3>
          <div id="affiliate-products"></div>

          <h3>ì œíœ´ë³´í—˜</h3>
          <div id="affiliate-insurance"></div>

          <p class="notice">
            ë³¸ ì œíœ´ìƒí’ˆ ë° ì œíœ´ë³´í—˜ì€ ì†Œì •ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì§€ê¸‰ë°›ìŠµë‹ˆë‹¤.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    const result = JSON.parse(localStorage.getItem("aiResult") || "{}");
    const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");
    const topic = localStorage.getItem("aiTopic") || "AI ê±´ê°• ì§„ë‹¨";

    const riskInfo = document.getElementById("riskInfo");

    // âœ… ìœ„í—˜ë„ ê³„ì‚°
    const riskWords = ["ìœ„í—˜","í†µì¦","ì‹¬í•¨","ì•…í™”","ë¶ˆì•ˆ","ì €ë¦¼","ê°€ìŠ´","í˜¸í¡","ì¦‰ì‹œ","ê°‘ìê¸°"];
    let riskScore = 0;
    answers.forEach(a => {
      riskWords.forEach(w => {
        if (a.includes(w)) riskScore++;
      });
    });

    const riskLevel = riskScore >= 5 ? "High" : riskScore >= 3 ? "Moderate" : "Mild";
    const riskValue = Math.min(riskScore * 10, 100);

    riskInfo.innerText = `ì£¼ì œ: ${topic}\nì´ ì‘ë‹µ ìˆ˜: ${answers.length}ê°œ\nìœ„í—˜ë‹¨ì–´ ê°ì§€ ìˆ˜: ${riskScore}ê°œ\nìœ„í—˜ë„ ì§€í‘œ: ${riskValue}/100 (${riskLevel})`;

    // âœ… ì°¨íŠ¸ í‘œì‹œ
    const ctx = document.getElementById("riskChart");
    new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["ìœ„í—˜ë„", "ì•ˆì •"],
        datasets: [{
          data: [riskValue, 100 - riskValue],
          backgroundColor: ["#6ba7ff", "#22324b"],
          borderWidth: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        cutout: "70%"
      }
    });

    // âœ… ìƒì„¸ì§„ë‹¨ / ìš”ì•½ / ì „ë¬¸ê°€ ì˜ê²¬
    document.getElementById("diagnosis").innerText =
      result.diagnosis || "ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ìƒí™œê´€ë¦¬ì™€ ê²½ê³¼ê´€ì°°ì„ ë³‘í–‰í•˜ì„¸ìš”.";
    document.getElementById("summary").innerText =
      result.summary || "ë¶„ì„ ê²°ê³¼ ì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì´ë©°, ìƒí™œìŠµê´€ ê´€ë¦¬ê°€ ê¶Œì¥ë©ë‹ˆë‹¤.";
    document.getElementById("expert").innerText =
      result.expert || "AI ë¶„ì„ ê²°ê³¼, í˜„ì¬ ìƒíƒœëŠ” ì–‘í˜¸í•©ë‹ˆë‹¤. ì •ê¸°ì ì¸ ê²€ì§„ì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.";

    // âœ… ì œíœ´ìƒí’ˆ + ì œíœ´ë³´í—˜ í‘œì‹œ
    fetch("affiliate.json")
      .then(res => res.json())
      .then(data => {
        if (!data[topic]) return;

        // --- ì œíœ´ìƒí’ˆ ---
        if (data[topic].products && data[topic].products.length > 0) {
          const box = document.getElementById("affiliate-products");
          box.innerHTML = "";
          data[topic].products.forEach(item => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
              <div class="icon">ğŸ›ï¸</div>
              <div class="name">${item.name}</div>
              <div class="desc">${item.desc}</div>
              <a href="${item.link}" target="_blank">ì¿ íŒ¡ ë°”ë¡œê°€ê¸°</a>
            `;
            box.appendChild(div);
          });
        }

        // --- ì œíœ´ë³´í—˜ ---
        if (data[topic].insurance && data[topic].insurance.length > 0) {
          const ins = document.getElementById("affiliate-insurance");
          ins.innerHTML = "";
          data[topic].insurance.forEach(item => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
              <div class="icon">ğŸ’¼</div>
              <div class="name">${item.name}</div>
              <div class="desc">${item.desc}</div>
              <a href="${item.link}" target="_blank">ë³´í—˜ ë°”ë¡œê°€ê¸°</a>
            `;
            ins.appendChild(div);
          });
        }
      })
      .catch(err => console.error("affiliate.json ë¡œë“œ ì˜¤ë¥˜:", err));
  </script>
</body>
</html>
