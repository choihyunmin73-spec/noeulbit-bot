<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>AI 진단 결과</title>
<style>
  :root{--bg:#0d1420;--panel:#121a26;--panel2:#182235;--line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;}
  body{font-family:"Pretendard","Noto Sans KR",sans-serif;background:var(--bg);color:var(--white);margin:0}
  .wrap{max-width:1180px;margin:0 auto;padding:26px 32px 40px}
  h1{margin:6px 0 18px;color:#98c2ff;font-size:1.6rem}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:30px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:24px}
  .card.alt{background:var(--panel2)}
  h2{color:var(--brand);margin-top:0}
  h3{margin-top:22px;color:#9fc4ff}
  .muted{color:var(--muted)}
  .kv{display:grid;grid-template-columns:auto 1fr;gap:6px 12px;margin-bottom:14px}
  .bar{height:6px;background:#22324b;border-radius:4px;overflow:hidden;margin-top:6px;margin-bottom:20px}
  .bar span{display:block;height:100%;width:0;background:var(--brand);transition:width 0.6s ease}
  .aff{display:flex;align-items:flex-start;gap:12px;padding:10px 8px;border:1px solid var(--line);border-radius:10px;background:#1a2334;margin-bottom:8px;cursor:pointer;transition:0.2s}
  .aff:hover{background:#243451;transform:translateY(-2px)}
  .aff img{width:32px;height:32px}
  .tiny{font-size:0.8rem;color:#7e8aa8;text-align:center;margin-top:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>노을빛하루 AI 진단 결과</h1>

  <div class="grid">
    <section class="card">
      <h2>AI 진단결과</h2>
      <div class="kv">
        <div class="muted">주제</div><div id="kv-topic">-</div>
        <div class="muted">진단 단계</div><div id="kv-level">-</div>
        <div class="muted">총 응답 수</div><div id="kv-count">0개</div>
        <div class="muted">위험단어 수</div><div id="kv-riskwords">0개</div>
        <div class="muted">위험도 지표</div><div><span id="kv-riskscore">0</span>/100</div>
      </div>
      <div class="bar"><span id="riskBar"></span></div>

      <h3>상세 진단</h3>
      <div id="detail" class="muted">상세 진단 데이터가 없습니다.</div>

      <h3>요약</h3>
      <div id="summary" class="muted">요약 데이터 없음</div>

      <h3>전문가 의견</h3>
      <div id="expert" class="muted">전문가 의견 데이터 없음</div>
    </section>

    <section class="card alt">
      <h2>제휴상품</h2>
      <div id="supps"></div>
      <h2 style="margin-top:22px">제휴보험</h2>
      <div id="ins"></div>
      <div class="tiny">본 제휴상품 및 제휴보험은 소정의 수수료를 지급받습니다.</div>
    </section>
  </div>
</div>

<script>
const aiResult = JSON.parse(localStorage.getItem("aiResult") || "{}");
const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");
const topic = aiResult.topic || localStorage.getItem("aiTopic") || "종합 건강 체크";

// 상단 지표 표시
document.getElementById("kv-topic").textContent = topic;
document.getElementById("kv-level").textContent = aiResult.level || "Mild";
document.getElementById("kv-count").textContent = `${answers.length}개`;
document.getElementById("kv-riskwords").textContent = `${aiResult.riskWords || 0}개`;
document.getElementById("kv-riskscore").textContent = aiResult.riskScore || 0;
document.getElementById("riskBar").style.width = ((aiResult.riskScore || 0) + "%");

// 상세 진단
document.getElementById("detail").textContent = aiResult.detail || "응답 데이터를 기반으로 상세 분석을 수행했습니다. 경과 관찰과 생활 관리를 병행하세요.";

// 요약
document.getElementById("summary").textContent = aiResult.summary || "응답 결과를 바탕으로 전반적인 상태는 안정적입니다. 생활관리 위주의 접근이 권장됩니다.";

// 전문가 의견
document.getElementById("expert").textContent = aiResult.expert || "특별히 긴급한 위험 요소는 없으나, 증상 변화 시 의료상담을 권장드립니다.";

// 제휴상품 / 보험
fetch("/affiliate.json")
  .then(r => r.json())
  .then(map => {
    const suppList = map[topic] || [];
    const supps = document.getElementById("supps");
    if (!suppList.length) {
      supps.innerHTML = "<div class='muted'>해당 주제에 등록된 제휴상품이 없습니다.</div>";
    } else {
      suppList.forEach(item => {
        const div = document.createElement("div");
        div.className = "aff";
        div.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/2965/2965567.png">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.desc || ""}</div>
            <div class="muted">쿠팡 바로가기</div>
          </div>`;
        div.onclick = () => window.open(item.link, "_blank");
        supps.appendChild(div);
      });
    }

    const insList = map["보험상품"] || [];
    const ins = document.getElementById("ins");
    if (!insList.length) {
      ins.innerHTML = "<div class='muted'>현재 표시할 보험 정보가 없습니다.</div>";
    } else {
      insList.forEach(item => {
        const div = document.createElement("div");
        div.className = "aff";
        div.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/2966/2966327.png">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.desc || ""}</div>
            <div class="muted">바로가기</div>
          </div>`;
        div.onclick = () => window.open(item.link, "_blank");
        ins.appendChild(div);
      });
    }
  })
  .catch(() => {
    document.getElementById("supps").innerHTML = "<div class='muted'>제휴상품 정보를 불러오지 못했습니다.</div>";
    document.getElementById("ins").innerHTML = "<div class='muted'>보험 정보를 불러오지 못했습니다.</div>";
  });
</script>
</body>
</html>
