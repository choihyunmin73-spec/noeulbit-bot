<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI 진단 문항</title>
<style>
  :root{--bg:#0d1420;--panel:#121a26;--panel2:#182235;--line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;}
  body{font-family:"Pretendard","Noto Sans KR",sans-serif;background:var(--bg);color:var(--white);margin:0}
  .wrap{max-width:860px;margin:0 auto;padding:30px 24px;text-align:center}
  h1{color:#98c2ff;margin-bottom:12px}
  h2{font-size:1.1em;color:#c9dbff;margin-bottom:24px}
  .options{display:flex;flex-direction:column;gap:10px;align-items:center;margin-top:20px}
  button{background:var(--panel2);color:var(--white);border:1px solid var(--line);border-radius:8px;
          padding:12px 16px;width:100%;max-width:520px;cursor:pointer;transition:all .2s}
  button:hover{background:#20304a}
  .progress{margin-top:30px;font-size:0.95em;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>AI 건강 진단</h1>
  <h2 id="questionText">문항을 불러오는 중...</h2>
  <div class="options" id="options"></div>
  <div class="progress" id="progress"></div>
</div>

<script>
  let currentQuestion = 0;
  let selectedAnswers = [];
  let topic = localStorage.getItem("aiTopic");
  const questionText = document.getElementById("questionText");
  const optionsContainer = document.getElementById("options");
  const progress = document.getElementById("progress");

  // ✅ 문항 로드
  fetch("survey.json")
    .then(res => res.json())
    .then(data => {
      const questions = data[topic];
      if (!questions) {
        questionText.textContent = "문항 데이터를 불러올 수 없습니다.";
        return;
      }
      showQuestion(questions);
    });

  // ✅ 문항 표시
  function showQuestion(questions) {
    const q = questions[currentQuestion];
    questionText.textContent = q.question;
    optionsContainer.innerHTML = "";

    q.options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt;
      btn.onclick = () => {
        selectedAnswers.push(opt);
        currentQuestion++;
        if (currentQuestion < questions.length) {
          showQuestion(questions);
        } else {
          finishSurvey();
        }
      };
      optionsContainer.appendChild(btn);
    });

    progress.textContent = `(${currentQuestion + 1}/${questions.length})`;
  }

  // ✅ 완료 시 처리
  function finishSurvey() {
    localStorage.setItem("aiAnswers", JSON.stringify(selectedAnswers));

    // ✅ 로컬스토리지 쓰기 지연 → 데이터 유실 방지
    setTimeout(() => {
      window.location.href = "loading.html";
    }, 300);
  }
</script>
</body>
</html>
