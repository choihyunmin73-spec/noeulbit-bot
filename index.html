<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë…¸ì„ë¹›í•˜ë£¨ ë¬´ë£Œ ê±´ê°• ì²´í¬</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Pretendard', sans-serif; background:#f3f4f6; }
    .bubble { border-radius:1rem; padding:.8rem 1rem; box-shadow:0 4px 16px rgba(0,0,0,0.06); }
    .bot { background:#fff; }
    .user { background:#e0f2fe; }
    .chip { border:1px solid #e5e7eb; border-radius:999px; padding:.6rem 1rem; cursor:pointer; text-align:center; }
    .chip:hover { background:#f1f5f9; }
    .btn { background:#0284c7; color:white; font-weight:700; border-radius:.75rem; padding:.8rem 1rem; }
  </style>
</head>

<body>

<main class="mx-auto max-w-2xl p-6">

  <!-- Header -->
  <header class="mb-5">
    <h1 class="text-2xl font-bold text-slate-800">ë…¸ì„ë¹›í•˜ë£¨ ë¬´ë£Œ ê±´ê°• ì²´í¬</h1>
    <p class="text-slate-500 text-sm mt-1">
      ì•„ë˜ ì§ˆë¬¸ë“¤ì„ ì„ íƒí•˜ë©´, AIê°€ ë¬´ë£Œë¡œ ê±´ê°• ìƒíƒœë¥¼ ì²´í¬í•˜ê³  í•„ìš”í•œ ì •ë³´ë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.
    </p>
  </header>

  <!-- ì „ì²´ 1ì»¬ëŸ¼ ì±—ë´‡ -->
  <section class="bg-white p-5 rounded-xl shadow">

    <!-- Chat -->
    <div id="chat" class="space-y-3 max-h-[70vh] overflow-auto pr-1">
      <div class="bubble bot">
        í™•ì¸í•˜ê³  ì‹¶ì€ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš” ğŸ˜Š
      </div>

      <div id="topicChips" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
    </div>

    <!-- Input -->
    <form id="userForm" class="mt-4 flex gap-2" onsubmit="return false;">
      <input id="userInput"
        class="flex-1 rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-300"
        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒì§€ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”" />
      <button id="sendBtn" class="btn" disabled>ë³´ë‚´ê¸°</button>
    </form>

  </section>

  <footer class="text-center text-xs text-slate-400 mt-6">
    Â© ë…¸ì„ë¹›í•˜ë£¨ â€” Senior-friendly Advisor
  </footer>

</main>

<script>
/* âœ… 1) ì£¼ì œ ëª©ë¡ */
const TOPICS = [
  { id:"joint", label:"ë¬´ë¦Â·ê´€ì ˆ" },
  { id:"bp", label:"í˜ˆì••" },
  { id:"sugar", label:"í˜ˆë‹¹Â·ë‹¹ë‡¨" },
  { id:"sleep", label:"ë¶ˆë©´ì¦Â·ìˆ˜ë©´" },
    { id:"scam", label:"ë³´ì´ìŠ¤í”¼ì‹±" },
  { id:"welfare", label:"ë³µì§€Â·ì§€ì›ê¸ˆ" },
  { id:"phone", label:"ìŠ¤ë§ˆíŠ¸í° ë¬¸ì œ" },
  { id:"senior_ins", label:"ì‹œë‹ˆì–´ ë³´í—˜Â·ê±´ê°•ë³´í—˜" }
];

/* âœ… 2) ì£¼ì œë³„ ì„¸ë¶€ ì„¤ë¬¸ */
const CHECKS = {

  /* (ì˜ˆ: ê¸°ì¡´ joint/bp/sugar ë“±ì€ ê·¸ëŒ€ë¡œ ë„£ìœ¼ë©´ ë¨) */

  sleep: [
    { q:"í‰ê·  ìˆ˜ë©´ ì‹œê°„ì€?", opts:["4ì‹œê°„ ì´í•˜","4~6ì‹œê°„","6~7ì‹œê°„","7ì‹œê°„ ì´ìƒ"] },
    { q:"ì ë“œëŠ” ë° ì–´ë ¤ì›€ì´ ìˆë‚˜ìš”?", opts:["ì˜ˆ","ì•„ë‹ˆì˜¤"] },
    { q:"ìƒˆë²½ì— ìì£¼ ê¹¨ë‚˜ìš”?", opts:["ì˜ˆ","ì•„ë‹ˆì˜¤"] },
    { q:"ì•„ì¹¨ì— ìƒì¾Œí•œê°€ìš”?", opts:["ì˜ˆ","ì•„ë‹ˆì˜¤","ë³´í†µ"] },
    { q:"ë‚® í”¼ë¡œê°ì´ ìˆë‚˜ìš”?", opts:["ìì£¼ ìˆìŒ","ê°€ë” ìˆìŒ","ê±°ì˜ ì—†ìŒ"] }
  ],

  senior_ins: [
    { q:"í˜„ì¬ ê°€ì…ëœ ë³´í—˜ì´ ìˆë‚˜ìš”?", opts:["ìˆìŒ","ì—†ìŒ","ëª¨ë¦„"] },
    { q:"ì›” ë³´í—˜ë£ŒëŠ” ì–´ë–¤ê°€ìš”?", opts:["ë¶€ë‹´ë¨","ì ë‹¹í•¨","ì „í˜€ ë¶€ë‹´ ì—†ìŒ"] },
    { q:"ìµœê·¼ ë³‘ì› ì§„ë£Œ ê²½í—˜ì´ ìˆë‚˜ìš”?", opts:["ì˜ˆ","ì•„ë‹ˆì˜¤"] },
    { q:"ë³´í—˜ ìƒë‹´ì„ ë°›ì•„ë³¸ ì  ìˆë‚˜ìš”?", opts:["ìˆìŒ","ì—†ìŒ"] },
    { q:"ê°€ì¥ ê±±ì •ë˜ëŠ” ë¶€ë¶„ì€?", opts:["ì˜ë£Œë¹„ ì¦ê°€","ë³´ì¥ ë¶€ì¡±","ë³´í—˜ ê°±ì‹ Â·í•´ì§€","ìƒë‹´ í•„ìš”"] }
  ]
};

let currentTopic = null;
let currentStep = 0;
let answers = [];

const chat = document.getElementById("chat");
const chips = document.getElementById("topicChips");

/* âœ… 3) ì£¼ì œ ì„ íƒ ë²„íŠ¼ ìƒì„± */
TOPICS.forEach(t=>{
  const c = document.createElement("div");
  c.className="chip";
  c.innerText=t.label;
  c.onclick=()=> startSurvey(t.id, t.label);
  chips.appendChild(c);
});

/* âœ… ì±—ë´‡ ë§í’ì„  í‘œì‹œ */
function bot(msg){
  const b=document.createElement("div");
  b.className="bubble bot";
  b.innerText=msg;
  chat.appendChild(b);
  chat.scrollTop=chat.scrollHeight;
}
function user(msg){
  const u=document.createElement("div");
  u.className="bubble user ml-auto max-w-[85%]";
  u.innerText=msg;
  chat.appendChild(u);
  chat.scrollTop=chat.scrollHeight;
}

/* âœ… ì„¤ë¬¸ ì‹œì‘ */
function startSurvey(id, label){
  currentTopic = id;
  currentStep = 0;
  answers = [];

  user(label);
  bot(`"${label}" ê´€ë ¨ ìƒíƒœë¥¼ í™•ì¸í•´ë³¼ê²Œìš”.`);

  setTimeout(()=> renderStep(), 500);
}

/* âœ… ë‹¨ê³„ë³„ ì§ˆë¬¸ ë Œë”ë§ */
function renderStep(){
  const step = CHECKS[currentTopic][currentStep];

  const q = document.createElement("div");
  q.className="bubble bot";
  q.innerText=step.q;
  chat.appendChild(q);

  step.opts.forEach(opt=>{
    const btn=document.createElement("div");
    btn.className="chip mt-1";
    btn.innerText=opt;

    btn.onclick=()=>{
      user(opt);
      answers.push(opt);
      currentStep++;

      if(currentStep < CHECKS[currentTopic].length){
        setTimeout(()=> renderStep(), 400);
      } else {
        sendToAI();
      }
    };

    chat.appendChild(btn);
  });

  chat.scrollTop=chat.scrollHeight;
}

/* âœ… AIì—ê²Œ ë¶„ì„ ìš”ì²­ */
async function sendToAI(){
  bot("AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤â€¦ â³");

  try{
    const res = await fetch("/analyze",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        topic: currentTopic,
        answers: answers
      })
    });

    const data = await res.json();

    bot("âœ… ë¶„ì„ ê²°ê³¼");
    bot(data.result);

  } catch(e){
    bot("âŒ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
}
</script>

</body>
</html>

