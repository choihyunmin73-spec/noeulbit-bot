<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>노을빛하루 AI 진단 결과</title>
<style>
  :root {
    --bg:#0d1420;--panel:#121a26;--panel2:#182235;
    --line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;
  }
  body {
    font-family:"Pretendard","Noto Sans KR",sans-serif;
    background:var(--bg);color:var(--white);margin:0;
  }
  .wrap {
    max-width:1180px;margin:0 auto;padding:26px 32px 40px;
    display:flex;flex-wrap:wrap;gap:28px;
  }
  h1 {color:#98c2ff;margin:6px 0 18px;}
  .left, .right {
    background:var(--panel);border:1px solid var(--line);
    border-radius:14px;padding:24px;flex:1;min-width:360px;
  }
  .section {margin-bottom:28px;}
  h2 {font-size:1.2em;color:#6ba7ff;margin-bottom:10px;}
  p {line-height:1.7em;color:#dce5ff;}
  .graph {
    height:22px;background:var(--panel2);border-radius:10px;
    overflow:hidden;margin:8px 0 16px;
  }
  .bar {
    height:100%;width:0;background:linear-gradient(90deg,#5b8cff,#6ba7ff);
    border-radius:10px;transition:width 0.8s ease;
  }
  .affiliate-box {
    display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
    gap:12px;margin-top:16px;
  }
  .item {
    background:var(--panel2);border:1px solid var(--line);
    border-radius:10px;padding:14px;text-align:center;
    transition:0.2s;
  }
  .item:hover {transform:translateY(-3px);border-color:#6ba7ff;}
  .item a {
    color:#6ba7ff;text-decoration:none;font-size:0.9em;
  }
  .small-note {
    color:#9fb1cf;font-size:0.78em;text-align:right;margin-top:10px;
  }
  @media(max-width:900px){.wrap{flex-direction:column;}}
</style>
</head>
<body>
<div class="wrap">
  <div class="left">
    <h1>AI 진단 결과</h1>
    <div class="section">
      <h2>기본 정보</h2>
      <p id="topic"></p>
      <p id="summary"></p>
    </div>

    <div class="section">
      <h2>위험도 지표</h2>
      <div class="graph"><div class="bar" id="risk-bar"></div></div>
      <p>응답 수: <span id="answer-count">0</span>개</p>
      <p>위험 단어 수: <span id="risk-word-count">0</span>개</p>
      <p>위험도 수준: <span id="risk-level">-</span></p>
    </div>

    <div class="section">
      <h2>상세 진단</h2>
      <div id="analysis"></div>
    </div>

    <div class="section">
      <h2>요약</h2>
      <div id="summary-text"></div>
    </div>

    <div class="section">
      <h2>전문가 의견</h2>
      <div id="expert"></div>
    </div>
  </div>

  <div class="right">
    <h2>추천 제휴상품</h2>
    <div id="affiliate-products" class="affiliate-box"></div>

    <h2 style="margin-top:24px;">추천 제휴보험</h2>
    <div id="affiliate-insurance" class="affiliate-box"></div>

    <div class="small-note">
      ※ 본 제휴상품 및 제휴보험은 소정의 수수료를 지급받습니다.
    </div>
  </div>
</div>

<script>
const topic = localStorage.getItem("aiTopic");
const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");

document.getElementById("topic").textContent = `현재 주제: ${topic}`;
document.getElementById("answer-count").textContent = answers.length;

// ✅ 위험 단어 감지
const riskWords = ["통증","어려움","위험","높음","갑자기","숨","저림","심함"];
let riskCount = 0;
answers.forEach(a => riskWords.forEach(w => { if (a.includes(w)) riskCount++; }));

document.getElementById("risk-word-count").textContent = riskCount;

// ✅ 위험도 계산
let riskScore = Math.min((riskCount / answers.length) * 100, 100);
let level = "Mild";
if (riskScore >= 70) level = "Severe";
else if (riskScore >= 40) level = "Moderate";

document.getElementById("risk-level").textContent = level;
document.getElementById("risk-bar").style.width = `${riskScore}%`;

// ✅ 분석 텍스트
let analysisText = `
현재 주제는 '${topic}'이며, 위험도는 ${level} 수준으로 평가되었습니다.<br>
응답 데이터를 분석한 결과, ${riskCount > 0 ? "특정 위험 단어가 감지되었습니다." : "위험 단어는 감지되지 않았습니다."}<br>
현재 상태는 비교적 안정적이며 생활 관리 중심의 접근이 권장됩니다.<br>
생활 습관 개선과 규칙적인 수면이 도움이 됩니다.<br>
스트레스를 줄이고 균형 잡힌 식단을 유지하세요.<br>
가벼운 운동과 충분한 수분 섭취가 중요합니다.<br>
증상이 지속된다면 3일 이내 전문의 상담을 권장합니다.<br>
정기적인 건강검진으로 상태를 점검하세요.<br>
무리한 활동은 피하고 충분한 휴식을 취하세요.<br>
필요 시 영양제 복용으로 체내 밸런스를 보완하세요.<br>
`;
document.getElementById("analysis").innerHTML = analysisText;

// ✅ 요약
document.getElementById("summary-text").innerHTML = `
주제: ${topic}<br>
위험도 수준: ${level}<br>
응답 수: ${answers.length}개<br>
전반적으로 안정적이며, 생활관리 중심의 접근이 권장됩니다.<br>
정기적인 검진과 생활습관 개선으로 건강을 유지하세요.<br>
`;

// ✅ 전문가 의견
document.getElementById("expert").innerHTML = `
AI 분석 결과, 특별한 위험 요소는 크지 않습니다.<br>
지속적인 생활관리와 정기 검진을 통해 건강을 유지하세요.
`;

// ✅ 제휴상품 + 보험 로드
fetch("affiliate.json")
  .then(res => res.json())
  .then(data => {
    if (!data[topic]) return;
    const productBox = document.getElementById("affiliate-products");
    const insuranceBox = document.getElementById("affiliate-insurance");

    data[topic].products.forEach(p => {
      const item = document.createElement("div");
      item.className = "item";
      item.innerHTML = `<div>${p.name}</div><a href="${p.link}" target="_blank">구매하기</a>`;
      productBox.appendChild(item);
    });

    data[topic].insurance.forEach(i => {
      const item = document.createElement("div");
      item.className = "item";
      item.innerHTML = `<div>${i.name}</div><a href="${i.link}" target="_blank">보험 보기</a>`;
      insuranceBox.appendChild(item);
    });
  });
</script>
</body>
</html>
