<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>노을빛하루 AI 진단 질문</title>
<style>
  :root{--bg:#0d1420;--panel:#121a26;--panel2:#182235;--line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;}
  body{
    font-family:"Pretendard","Noto Sans KR",sans-serif;
    background:var(--bg);
    color:var(--white);
    margin:0;
    padding:0;
    min-height:100vh;
  }
  .wrap{
    width:88%;
    max-width:720px;
    margin:0 auto;
    padding:24px 0 50px;
    position:relative;
    top:40px;
  }
  h2{
    color:#98c2ff;
    margin:0 0 18px;
    font-size:20px;
    text-align:center;
  }
  .box{
    background:var(--panel2);
    border:1px solid var(--line);
    border-radius:16px;
    padding:22px;
    width:100%;
    box-sizing:border-box;
  }
  .q{
    font-size:18px;
    margin-bottom:14px;
    color:#e1ecff;
    text-align:center;
    line-height:1.4;
  }
  .opt{
    background:#22324b;
    border:1px solid #315d93;
    border-radius:10px;
    padding:8px;
    margin:6px 0;
    cursor:pointer;
    color:#cfe2ff;
    font-size:15px;
    text-align:center;
    display:flex;
    align-items:center;
    justify-content:center;
    width:100%;
    min-height:38px;
    transition:all .2s;
  }
  .opt:hover{
    background:#3969b5;
    color:#fff;
    transform:translateY(-2px);
  }
  .info{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:14px 0 6px;
    color:#a4b6d6;
    justify-content:center;
    font-size:13px;
  }
  .bar{
    height:8px;
    border-radius:4px;
    background:#23304a;
    overflow:hidden;
    width:90%;
    max-width:500px;
    margin:0 auto;
  }
  .bar > span{
    display:block;
    height:100%;
    width:0;
    background:#6ba7ff;
    transition:width .25s;
  }
  a.btn{
    display:inline-block;
    background:#294e80;
    border:1px solid #3d6bb0;
    color:#fff;
    padding:9px 12px;
    border-radius:8px;
    margin-top:16px;
    text-decoration:none;
    font-size:14px;
  }
  @media(max-width:768px){
    .wrap{width:94%;top:20px;}
    .box{padding:16px;}
    h2{font-size:17px;}
    .q{font-size:15px;}
    .opt{font-size:14px;min-height:36px;padding:7px;}
  }
  @media(min-width:1200px){
    .wrap{max-width:700px;}
    .opt{font-size:15px;min-height:40px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h2 id="title">AI 건강 진단</h2>
    <div class="box">
      <div class="q" id="question">질문을 불러오는 중…</div>
      <div id="options"></div>
      <div class="info">
        <div id="progressTxt">질문 1 / 8</div>
      </div>
      <div class="bar"><span id="barFill"></span></div>
      <a class="btn" href="index.html">처음으로</a>
    </div>
  </div>

<script>
const qp = new URLSearchParams(location.search);
const topic = qp.get("topic") || "알 수 없음";
document.getElementById("title").textContent = `주제: ${topic}`;

let survey = {};
let idx = 0;
const answers = [];

fetch("survey.json")
  .then(r => r.json())
  .then(data => {
    survey = data;
    if (!survey[topic]) {
      document.getElementById("question").textContent = "해당 주제의 문항을 찾을 수 없습니다.";
      return;
    }
    render();
  })
  .catch(() => {
    document.getElementById("question").textContent = "문항 데이터를 불러오지 못했습니다.";
  });

function render(){
  const list = survey[topic];
  const q = list[idx];
  document.getElementById("question").textContent = q.question;

  const optBox = document.getElementById("options");
  optBox.innerHTML = "";
  q.choices.forEach(ch => {
    const d = document.createElement("div");
    d.className = "opt";
    d.textContent = ch;
    d.onclick = () => choose(ch);
    optBox.appendChild(d);
  });

  document.getElementById("progressTxt").textContent = `질문 ${idx+1} / ${list.length}`;
  document.getElementById("barFill").style.width = `${((idx+1)/list.length)*100}%`;
}

async function choose(ch){
  answers.push(ch);
  idx++;
  const list = survey[topic];

  if (idx < list.length) {
    render();
  } else {
    // ✅ Render 서버 전용: 결과 분석 전 로딩페이지로 이동
    localStorage.setItem("aiTopic", topic);
    localStorage.setItem("aiAnswers", JSON.stringify(answers));
    window.location.href = "loading.html";
  }
}
</script>
</body>
</html>
