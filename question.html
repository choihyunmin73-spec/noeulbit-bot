<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI 건강 진단</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; }
    h2 { margin-bottom: 20px; }
    .option-button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #f5f5f5;
      transition: background-color 0.2s;
    }
    .option-button:hover { background-color: #e0e0e0; }
  </style>
</head>
<body>

  <div id="question-container">Loading questions...</div>

  <script>
    let surveyData = {};
    let topics = [];
    let currentTopicIndex = 0;
    let currentQuestionIndex = 0;
    let totalScore = 0;

    // survey.json 불러오기
    fetch('survey.json')
      .then(response => response.json())
      .then(data => {
        surveyData = data;
        topics = Object.keys(data);
        renderQuestion();
      })
      .catch(err => {
        document.getElementById('question-container').textContent = '질문 로드 실패';
        console.error(err);
      });

    function renderQuestion() {
      if (currentTopicIndex >= topics.length) {
        // 모든 질문 끝 → 결과 페이지로 이동
        localStorage.setItem('totalScore', totalScore);
        window.location.href = 'result.html';
        return;
      }

      const topic = topics[currentTopicIndex];
      const questionObj = surveyData[topic][currentQuestionIndex];

      const questionContainer = document.getElementById('question-container');
      questionContainer.innerHTML = '';

      // 질문 텍스트
      const qText = document.createElement('h2');
      qText.textContent = questionObj.question;
      questionContainer.appendChild(qText);

      // 옵션 버튼 생성
      questionObj.options.forEach((opt) => {
        const button = document.createElement('button');
        button.textContent = opt.text;
        button.className = 'option-button';
        button.addEventListener('click', () => selectOption(opt.score));
        questionContainer.appendChild(button);
      });
    }

    function selectOption(score) {
      totalScore += score;
      const topic = topics[currentTopicIndex];

      currentQuestionIndex++;

      // 해당 주제 질문 끝나면 다음 주제로 이동
      if (currentQuestionIndex >= surveyData[topic].length) {
        currentTopicIndex++;
        currentQuestionIndex = 0;
      }

      renderQuestion();
    }
  </script>

</body>
</html>
