<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI 진단 결과</title>
<style>
body {
  background-color: #0f172a;
  color: #e2e8f0;
  font-family: 'Noto Sans KR', sans-serif;
 margin: 0 auto;
  padding: 0 80px;
  max-width: 1400px;  /* ✅ 중앙 정렬 + 양쪽 여백 고정 */
}
.container {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 20px;
  padding: 30px;
}
.left, .right {
  background-color: #1e293b;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
.left { width: 65%; }
.right { width: 30%; }
h2 { color: #60a5fa; }
.metric-box {
  display: flex;
  gap: 20px;
  margin-bottom: 10px;
}
.metric {
  background-color: #334155;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 15px;
}
.progress-bar {
  background-color: #334155;
  border-radius: 10px;
  overflow: hidden;
  height: 8px;
  margin: 8px 0 16px 0;
}
.progress { background-color: #60a5fa; height: 100%; width: 0%; transition: width 1s ease-in-out; }
ul { padding-left: 20px; }
button {
  background-color: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 15px;
  font-size: 14px;
  margin: 8px 4px;
  cursor: pointer;
}
button:hover { background-color: #2563eb; }

.affiliate-box, .insurance-box {
  background-color: #1e293b;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 15px;
}
.affiliate-box h3, .insurance-box h3 {
  color: #93c5fd;
  border-bottom: 1px solid #334155;
  padding-bottom: 6px;
  margin-bottom: 10px;
}
.affiliate-item {
  background-color: #334155;
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  transition: 0.2s;
}
.affiliate-item:hover {
  background-color: #3b5178;
  transform: translateY(-2px);
}
.affiliate-item strong { color: #fbbf24; }
.affiliate-note {
  font-size: 11px;
  color: #94a3b8;
  text-align: center;
  margin-top: 8px;
}
</style>
</head>
<body>
<div class="container">
  <div class="left">
    <h2>AI 진단 결과</h2>
    <p><strong>주제:</strong> <span id="topic">-</span></p>
    <div class="metric-box">
      <div class="metric">총 응답 수: <span id="answerCount">0</span>개</div>
      <div class="metric">위험단어 수: <span id="riskCount">0</span>개</div>
      <div class="metric">위험도 지표: <span id="riskScore">0</span>/100 (<span id="riskLevel">-</span>)</div>
    </div>
    <div class="progress-bar"><div class="progress" id="progressBar"></div></div>

    <h3>상세 진단</h3>
    <ul id="detail"></ul>

    <h3>요약</h3>
    <ul id="summary"></ul>

    <h3>전문가 의견</h3>
    <ul id="opinion"></ul>

    <div>
      <button onclick="goHome()">처음으로 돌아가기</button>
      <button onclick="redo()">다시 진단하기</button>
    </div>
  </div>

  <div class="right">
    <div class="affiliate-box">
      <h3>제휴상품 (필요하신 영양제)</h3>
      <div id="affiliateList"></div>
      <p class="affiliate-note">본 제휴상품 및 제휴보험은 소정의 수수료를 지급받습니다.</p>
    </div>
    <div class="insurance-box">
      <h3>제휴보험 (체크해 보세요)</h3>
      <div id="insuranceList"></div>
    </div>
  </div>
</div>

<script>
function goHome(){window.location.href="index.html";}
function redo(){window.location.href="question.html";}

const result = JSON.parse(localStorage.getItem("aiResult") || "{}");
const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");
const topic = result.topic || "알 수 없음";
document.getElementById("topic").textContent = topic;

// ✅ 안전 기본값 처리
const answerCount = answers.length || 0;
const riskWords = result.riskWords ? result.riskWords.length : 0;
const riskScore = result.riskScore || 0;
const level = result.level || "Mild";

document.getElementById("answerCount").textContent = answerCount;
document.getElementById("riskCount").textContent = riskWords;
document.getElementById("riskScore").textContent = riskScore;
document.getElementById("riskLevel").textContent = level;
document.getElementById("progressBar").style.width = riskScore + "%";

// ✅ 분석 내용
const detail = document.getElementById("detail");
const summary = document.getElementById("summary");
const opinion = document.getElementById("opinion");

let detailText = [];
if (answers.length > 0) {
  detailText = [
    "현재 주제는 '" + topic + "'이며, 위험도는 " + level + " 수준으로 평가되었습니다.",
    "응답 데이터를 분석한 결과, 특정 위험 단어가 감지되었습니다.",
    "현재 상태는 비교적 안정적이나 일부 주의가 필요합니다.",
    "생활 습관 개선과 규칙적인 수면이 도움이 됩니다.",
    "스트레스를 줄이고 균형 잡힌 식단을 유지하세요.",
    "가벼운 운동과 충분한 수분 섭취가 중요합니다.",
    "증상이 지속된다면 3일 이내 전문의 상담을 권장합니다.",
    "정기적인 건강검진으로 상태를 주기적으로 점검하세요.",
    "통증, 불편감, 피로감이 반복된다면 조기 진료를 권합니다.",
    "심리적 안정이 신체 회복에 긍정적인 영향을 줍니다.",
    "무리한 활동은 피하고, 충분한 휴식을 취하세요.",
    "필요 시 영양제 복용으로 체내 밸런스를 보완하세요.",
    "경미한 이상이라도 반복되면 병원 내원 바랍니다.",
    "생활관리와 경과 관찰을 병행하세요.",
    "전반적으로 양호하나 세부적인 관리가 필요합니다."
  ];
} else {
  detailText = [
    "응답이 없어 기본 안전 수칙을 중심으로 안내합니다.",
    "현재 건강 상태는 전반적으로 안정적입니다.",
    "규칙적인 생활습관이 건강 유지에 도움이 됩니다.",
    "충분한 수면과 스트레스 관리가 필요합니다.",
    "가벼운 운동으로 신체 순환을 유지하세요.",
    "과로는 피하고, 꾸준한 수분 섭취를 하세요.",
    "흡연과 음주를 삼가고, 균형 잡힌 식단을 유지하세요.",
    "몸의 작은 변화에도 주의를 기울이세요.",
    "정기적인 검진으로 조기 예방이 가능합니다.",
    "증상이 생기면 2~3일 내 병원 내원 권장드립니다.",
    "마음의 안정도 신체 건강에 큰 영향을 미칩니다.",
    "불편감이 있다면 전문상담을 고려하세요.",
    "건강 기록을 꾸준히 관리하는 습관을 들이세요.",
    "생활관리와 경과 관찰을 병행하시기 바랍니다.",
    "전반적으로 양호한 상태로 보입니다."
  ];
}

const summaryText = [
  "주제: " + topic,
  "위험도 수준: " + level,
  "응답 수: " + answerCount + "개",
  "전반적으로 안정적이며, 생활관리 중심의 접근이 권장됩니다.",
  "정기적인 검진과 생활습관 개선으로 건강을 유지하세요.",
  "증상 지속 시 의료기관 내원 바랍니다.",
  "필요 시 관련 전문의 상담이 도움이 됩니다."
];
const opinionText = [
  "AI 분석 결과, 특별한 위험 요소는 크지 않습니다.",
  "지속적인 생활관리와 정기 검진을 통해 건강을 유지하세요."
];

// ✅ 출력
detailText.forEach(t=>{let li=document.createElement("li");li.textContent=t;detail.appendChild(li);});
summaryText.forEach(t=>{let li=document.createElement("li");li.textContent=t;summary.appendChild(li);});
opinionText.forEach(t=>{let li=document.createElement("li");li.textContent=t;opinion.appendChild(li);});

// ✅ 제휴상품 & 보험
fetch("affiliate.json")
.then(res=>res.json())
.then(data=>{
  const affList=document.getElementById("affiliateList");
  const insList=document.getElementById("insuranceList");
  const affItems=data[topic]||[];
  const insItems=data["보험공통"]||[];

  affItems.forEach(item=>{
    const div=document.createElement("div");
    div.className="affiliate-item";
    div.innerHTML=`<strong>${item.name}</strong><br>${item.desc}`;
    div.onclick=()=>window.open(item.link,"_blank");
    affList.appendChild(div);
  });

  insItems.forEach(item=>{
    const div=document.createElement("div");
    div.className="affiliate-item";
    div.innerHTML=`<strong>${item.name}</strong><br>${item.desc}`;
    div.onclick=()=>window.open(item.link,"_blank");
    insList.appendChild(div);
  });
})
.catch(()=>{
  document.getElementById("affiliateList").innerText="제휴 데이터를 불러오지 못했습니다.";
});
</script>
</body>
</html>
