<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ê±´ê°•Â·ìƒí™œ ì§„ë‹¨</title>

<style>
body {
    margin:0;
    background:#f5f7fb;
    font-family:'Noto Sans KR',sans-serif;
}
.wrap {
    max-width:900px;
    margin:25px auto;
}
.card {
    background:white;
    padding:24px;
    border-radius:16px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    margin-bottom:20px;
}
h2 {
    font-size:22px;
    font-weight:700;
    margin-bottom:10px;
}
p {
    color:#555;
    font-size:15px;
}
.btn {
    display:inline-block;
    background:#2f6efc;
    color:white;
    padding:14px 24px;
    border-radius:8px;
    font-size:17px;
    text-decoration:none;
    cursor:pointer;
    margin-top:10px;
}
.option {
    display:block;
    padding:10px 14px;
    border:1px solid #d1d5db;
    border-radius:8px;
    margin-bottom:8px;
    cursor:pointer;
    font-size:15px;
}
.option:hover {
    background:#eff6ff;
    border-color:#3b82f6;
}
.option.selected {
    background:#3b82f6;
    color:white;
    border-color:#2563eb;
}
@media(max-width:480px){
    .wrap{margin:15px;}
    h2{font-size:20px;}
}
</style>
</head>
<body>

<div class="wrap">
    <div class="card">
        <h2>ğŸ’  ë…¸ì„ë¹›í•˜ë£¨ AI ê±´ê°•Â·ìƒí™œ ì§„ë‹¨</h2>
        <p>ì•„ë˜ ì£¼ì œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
        <select id="topic" style="width:100%;padding:10px;font-size:16px;border-radius:8px;border:1px solid #ccc;">
            <option value="">-- ì£¼ì œ ì„ íƒ --</option>
            <option>ê´€ì ˆ í†µì¦</option>
            <option>í˜ˆì•• ê´€ë¦¬</option>
            <option>í˜ˆë‹¹Â·ë‹¹ë‡¨</option>
            <option>ë¶ˆë©´ì¦Â·ìˆ˜ë©´ì¥ì• </option>
            <option>ì–´ê¹¨Â·ëª© í†µì¦</option>
            <option>ì‹¬ì¥Â·í˜¸í¡Â·ê°€ìŠ´í†µì¦</option>
            <option>ë…¸ì•ˆÂ·ì‹œë ¥ì €í•˜</option>
            <option>ì¹˜ë§¤Â·ê¸°ì–µë ¥ ë¬¸ì œ</option>
            <option>ì „ë¦½ì„ Â·ë°°ë‡¨ ë¬¸ì œ</option>
            <option>ì¢…í•© ê±´ê°• ì²´í¬</option>
            <option>ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©</option>
            <option>ë³µì§€Â·ìƒí™œì§€ì›ê¸ˆ</option>
        </select>
    </div>

    <div id="surveyArea"></div>

    <div id="submitBtn" class="btn" style="display:none;">ê²°ê³¼ ë³´ê¸° â†’</div>
</div>

<script>
let surveyData = {};
let selectedAnswers = [];
let currentTopic = "";

// âœ… survey.json ë¶ˆëŸ¬ì˜¤ê¸°
fetch("survey.json")
    .then(res => res.json())
    .then(data => {
        surveyData = data;
    })
    .catch(err => console.error("âŒ ì„¤ë¬¸ ë¡œë“œ ì˜¤ë¥˜", err));

// âœ… ì£¼ì œ ì„ íƒ ì‹œ ë¬¸í•­ í‘œì‹œ
document.getElementById("topic").addEventListener("change", e => {
    const topic = e.target.value;
    currentTopic = topic;
    const container = document.getElementById("surveyArea");
    container.innerHTML = "";
    selectedAnswers = [];

    if (!topic) return;
    const questions = surveyData[topic];
    if (!questions) {
        container.innerHTML = "<p>âš ï¸ ì´ ì£¼ì œì— ëŒ€í•œ ì„¤ë¬¸ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>";
        return;
    }

    questions.forEach((q, qi) => {
        const card = document.createElement("div");
        card.className = "card";
        const title = document.createElement("h3");
        title.textContent = `${qi + 1}. ${q.q}`;
        card.appendChild(title);

        q.opt.forEach(opt => {
            const btn = document.createElement("div");
            btn.className = "option";
            btn.textContent = opt;
            btn.onclick = () => {
                // ì„ íƒ ì²˜ë¦¬
                const prev = card.querySelector(".selected");
                if (prev) prev.classList.remove("selected");
                btn.classList.add("selected");
                selectedAnswers[qi] = opt;
                checkAllAnswered();
            };
            card.appendChild(btn);
        });
        container.appendChild(card);
    });
});

// âœ… ëª¨ë“  ë¬¸í•­ ì‘ë‹µ ì™„ë£Œ ì‹œ ë²„íŠ¼ í‘œì‹œ
function checkAllAnswered() {
    const qCount = surveyData[currentTopic]?.length || 0;
    const answered = selectedAnswers.filter(Boolean).length;
    document.getElementById("submitBtn").style.display =
        answered === qCount ? "block" : "none";
}

// âœ… ê²°ê³¼ ë³´ê¸° í´ë¦­ ì‹œ
document.getElementById("submitBtn").onclick = async () => {
    const payload = { topic: currentTopic, checks: selectedAnswers };

    try {
        const res = await fetch("/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const result = await res.json();
        const encoded = encodeURIComponent(JSON.stringify(result));
        location.href = `/result?payload=${encoded}`;
    } catch (e) {
        alert("âš ï¸ ê²°ê³¼ ì „ì†¡ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        console.error(e);
    }
};
</script>
</body>
</html>
