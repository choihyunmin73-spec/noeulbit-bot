<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AI 종합 분석 결과</title>
<style>
  body{margin:0;background:#f5f7fb;font-family:"Noto Sans KR",system-ui}
  .wrap{max-width:1120px;margin:28px auto;padding:0 16px;display:grid;grid-template-columns:340px 1fr;gap:22px}
  .card{background:#fff;border:1px solid #e2e8f0;border-radius:12px;box-shadow:0 2px 8px rgba(15,23,42,.05);padding:18px}
  h3{margin:0 0 10px;color:#0f172a}
  .item{display:flex;gap:12px;padding:12px;border:1px solid #eef2f7;border-radius:10px;margin:10px 0}
  .item img{width:56px;height:56px;border-radius:8px;object-fit:cover;background:#f1f5f9}
  .link{display:inline-block;background:#2563eb;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none}
  .pill{font-size:12px;color:#475569}
  ul{margin:8px 0 0 18px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .muted{color:#64748b}
</style>
</head>
<body>
<div class="wrap">
  <!-- LEFT -->
  <div class="card">
    <h3>추천 제휴상품</h3>
    <div id="aff">로딩 중…</div>
  </div>

  <!-- RIGHT -->
  <div class="card">
    <h3 id="title">AI 종합 분석 결과</h3>
    <div class="muted" id="level"></div>
    <div style="margin:10px 0 14px;">
      <canvas id="chart" height="80"></canvas>
    </div>

    <div class="pill"><b>상세 진단</b></div>
    <ul id="detail"></ul>

    <div class="pill" style="margin-top:12px;"><b>요약</b></div>
    <ul id="summary"></ul>

    <div class="pill" style="margin-top:12px;"><b>의견</b></div>
    <ul id="opinion"></ul>

    <div class="row" style="margin-top:16px;">
      <a class="link" id="svc" href="javascript:void(0)">관련 서비스 바로가기</a>
      <a class="link" style="background:#334155" href="index.html">처음으로 돌아가기</a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const data = JSON.parse(localStorage.getItem("aiResult")||"null");
if(!data){ location.href="index.html"; }

document.getElementById("title").textContent = `[${data.topic}] AI 종합 결과`;
document.getElementById("level").textContent = `위험도: ${data.risk}% • 단계: ${data.level}`;

function toList(id, arr){
  const ul=document.getElementById(id); ul.innerHTML="";
  (arr||[]).forEach(t=>{const li=document.createElement("li"); li.textContent=t; ul.appendChild(li);});
}
toList("detail", data.detail);
toList("summary", data.summary);
toList("opinion", data.opinion);

// Chart
new Chart(document.getElementById("chart"),{
  type:"bar",
  data:{ labels:["위험도"], datasets:[{ data:[data.risk] }]},
  options:{ responsive:true, plugins:{legend:{display:false}}, scales:{ y:{ suggestedMin:0, suggestedMax:100 } } }
});

// Affiliates
const aff=document.getElementById("aff");
if(Array.isArray(data.affiliates)&&data.affiliates.length){
  aff.innerHTML="";
  data.affiliates.forEach(x=>{
    const d=document.createElement("div"); d.className="item";
    d.innerHTML = `<img src="${x.image||''}" alt="">
      <div><div><b>${x.name||''}</b></div>
      <div class="muted">${x.desc||''}</div>
      <div style="margin-top:8px"><a class="link" href="${x.url||'#'}" target="_blank">보러가기</a></div></div>`;
    aff.appendChild(d);
  });
}else{
  aff.textContent="추천 데이터를 불러올 수 없습니다.";
}

// 서비스 링크(토픽별 분기)
const svc=document.getElementById("svc");
if(data.topic.includes("자동차")) svc.href="https://auto.naver.com/"; 
else if(data.topic.includes("보험")) svc.href="https://www.google.com/search?q=%EB%B3%B4%ED%97%98%EB%A3%8C%20%EB%B9%84%EA%B5%90";
else svc.href="https://www.google.com/";

</script>
</body>
</html>
