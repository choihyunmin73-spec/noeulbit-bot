<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë…¸ì„ë¹›í•˜ë£¨ ì¢…í•© ì§„ë‹¨ ê²°ê³¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  background:#f5f7fb;
  font-family:'Noto Sans KR',sans-serif;
}
.wrap {
  max-width:920px;
  margin:25px auto;
}
.card {
  background:white;
  padding:28px;
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,0.08);
  margin-bottom:20px;
}
.title {
  font-size:24px;
  font-weight:800;
  margin-bottom:8px;
}
.sub {
  color:#6b7280;
  font-size:15px;
  margin-bottom:20px;
}
h3 {
  font-size:19px;
  margin-top:15px;
  margin-bottom:12px;
}
li {
  margin-bottom:8px;
  font-size:16px;
  line-height:1.45;
}
.btn {
  background:#2f6efc;
  color:white;
  padding:18px;
  border-radius:12px;
  text-align:center;
  font-size:18px;
  cursor:pointer;
  margin-top:18px;
}
.pill {
  display:inline-block;
  background:#eef2ff;
  padding:7px 12px;
  border-radius:999px;
  margin:4px 6px 4px 0;
  font-size:13px;
  color:#3742b1;
}
.pill.red { background:#ffe7e7; color:#b91c1c; }
.pill.amber { background:#fff3cd; color:#b54706; }

/* ğŸ”· AI ìš”ì•½ í…Œë‘ë¦¬ ë°•ìŠ¤ */
.ai-summary {
  border:2px solid #c7d2fe;
  background:#f9faff;
  border-radius:12px;
  padding:18px 20px;
  margin-bottom:20px;
}
.ai-summary h3 {
  color:#0f4fff;
  font-size:20px;
  margin-bottom:10px;
}
.ai-gauge {
  height:12px;
  border-radius:6px;
  background:#e4e7eb;
  overflow:hidden;
  margin:10px 0 6px;
}
.ai-gauge-fill {
  height:100%;
  background:#ff6961;
  width:0;
  transition:width 1s ease;
}

/* ëª¨ë°”ì¼ */
@media(max-width:480px){
  .wrap { margin:15px; }
  .card { padding:20px; }
  .title { font-size:22px; }
  h3 { font-size:18px; }
  li { font-size:15px; }
  .btn { font-size:17px; padding:16px; }
}
</style>
</head>
<body>

<div class="wrap">

  <!-- âœ… ê²°ê³¼ í—¤ë” -->
  <div class="card">
    <div class="title">ğŸ’  ë…¸ì„ë¹›í•˜ë£¨ ì¢…í•© ì§„ë‹¨ ê²°ê³¼</div>
    <div class="sub">ì„ íƒí•œ ë¬¸í•­ ê¸°ë°˜ìœ¼ë¡œ ë§ì¶¤ AI ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</div>

    <div id="pills"></div>
    <div class="ai-summary" id="ai-summary">
      <h3>AI ì¢…í•© ì§„ë‹¨ ìš”ì•½</h3>
      <div id="ai-text"></div>
      <div class="ai-gauge">
        <div class="ai-gauge-fill" id="ai-gauge-fill"></div>
      </div>
      <div style="font-size:14px;color:#555;" id="ai-percent"></div>
    </div>

    <div id="summary"></div>
  </div>

  <!-- âœ… ì…€í”„ ì¼€ì–´ -->
  <div class="card">
    <h3>âœ… ì…€í”„ ì¼€ì–´ ê°€ì´ë“œ</h3>
    <ul id="tips"></ul>
  </div>

  <!-- âœ… ìœ„í—˜ ì‹ í˜¸ -->
  <div class="card">
    <h3>âš ï¸ ì´ëŸ° ì¦ìƒì´ë©´ ì¦‰ì‹œ ì¡°ì¹˜</h3>
    <ul id="redflags"></ul>
    <div id="rf-note" style="color:#d62828;font-size:14px;margin-top:8px;"></div>
  </div>

  <!-- âœ… ì˜ì–‘ì œ / ë³´í—˜ ì„œë¹„ìŠ¤ -->
  <div class="card" id="extra-card" style="display:none;">
    <h3 id="extra-title"></h3>
    <ul id="extra-list"></ul>
  </div>

  <!-- âœ… ì„ íƒí•œ í•­ëª© -->
  <div class="card">
    <h3>ğŸ§¾ ì„ íƒí•œ í•­ëª©</h3>
    <div id="selected"></div>
  </div>

  <!-- âœ… ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ -->
  <div class="btn" onclick="location.href='/'">â† ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</div>
</div>

<script>
(function(){
  const params = new URLSearchParams(location.search);
  const raw = params.get("payload");
  let data = {};
  try { data = JSON.parse(decodeURIComponent(raw)); } catch(e){}

  /* âœ… ê¸°ë³¸ì •ë³´ í‘œì‹œ */
  const pills = [];
  pills.push(`<span class="pill">ì£¼ì œ: ${data.topic}</span>`);
  const sevClass =
      data.severity === "ë†’ìŒ" ? "red" :
      data.severity === "ì¤‘ê°„" ? "amber" : "";
  pills.push(`<span class="pill ${sevClass}">ìœ„í—˜ë„: ${data.severity}</span>`);
  document.getElementById("pills").innerHTML = pills.join(" ");

  /* âœ… AI ì¢…í•© ì§„ë‹¨ ìš”ì•½ */
  const aiText = document.getElementById("ai-text");
  const aiPercent = document.getElementById("ai-percent");
  const aiGauge = document.getElementById("ai-gauge-fill");

  const percent = data.percent || 0;
  aiText.innerHTML = data.aiSummary || "AI ì˜ˆì¸¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
  aiPercent.innerText = `ì˜ˆì¸¡ ìœ„í—˜ë„: ${percent}%`;
  setTimeout(()=>{ aiGauge.style.width = percent + "%"; }, 300);

  /* âœ… ìš”ì•½ */
  document.getElementById("summary").innerHTML =
    `<div style="margin-top:10px;"><b>ê¶Œì¥ ì¡°ì¹˜:</b> ${data.action || "ë°ì´í„° ë¶„ì„ ì¤‘"}</div>
     <div style="margin-top:6px;"><b>ê¶Œì¥ ì§„ë£Œê³¼:</b> ${data.dept || "-"}</div>`;

  /* âœ… ì…€í”„ ì¼€ì–´ */
  document.getElementById("tips").innerHTML =
    (data.tips||[]).map(t=>`<li>${t}</li>`).join("");

  /* âœ… ìœ„í—˜ ì‹ í˜¸ */
  const rf = data.redflags || [];
  document.getElementById("redflags").innerHTML =
    rf.length ? rf.map(r=>`<li>${r}</li>`).join("") :
    "<li>íŠ¹ë³„í•œ ì‘ê¸‰ ì‹ í˜¸ëŠ” ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</li>";
  if(rf.length){ document.getElementById("rf-note").innerText = "â€» ìœ„ ì¦ìƒì´ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ 119 ë˜ëŠ” ì‘ê¸‰ì‹¤ì„ ë°©ë¬¸í•˜ì„¸ìš”."; }

  /* âœ… ì„ íƒí•œ í•­ëª© */
  document.getElementById("selected").innerHTML =
    (data.checks||[]).map(c=>`<span class="pill">${c}</span>`).join(" ");

  /* âœ… ì£¼ì œë³„ ë§ì¶¤ ë¸”ë¡ (ê±´ê°•/ë¹„ê±´ê°• êµ¬ë¶„) */
  const extraCard = document.getElementById("extra-card");
  const extraTitle = document.getElementById("extra-title");
  const extraList = document.getElementById("extra-list");

  if(["ê´€ì ˆ í†µì¦","í˜ˆì•• ê´€ë¦¬","í˜ˆë‹¹Â·ë‹¹ë‡¨","ì–´ê¹¨Â·ëª© í†µì¦","ì‹¬ì¥Â·í˜¸í¡Â·ê°€ìŠ´í†µì¦","ë…¸ì•ˆÂ·ì‹œë ¥ì €í•˜","ì „ë¦½ì„ Â·ë°°ë‡¨ ë¬¸ì œ"].includes(data.topic)){
    extraCard.style.display = "block";
    extraTitle.innerText = "ğŸ’Š ì¶”ì²œ ì˜ì–‘ì œ / ë³´í—˜ ì„œë¹„ìŠ¤";
    extraList.innerHTML = `
      <li>âœ” MSM + ê¸€ë£¨ì½”ì‚¬ë¯¼ ë³µí•©ì œ</li>
      <li>âœ” ì˜¤ë©”ê°€3 (EPA 70% ì´ìƒ)</li>
      <li>âœ” ë¹„íƒ€ë¯¼ D + K2 ë³µí•©ì œ</li>
      <li>ğŸ’¡ ë¬´ë¦Â·ê´€ì ˆ ì¹˜ë£Œë¹„ ë³´ì¥í˜• ë³´í—˜ í™•ì¸</li>
      <li>ğŸ’¡ AI ë¶„ì„ ê¸°ë°˜ ë§ì¶¤ ë³´ì¥ ì§„ë‹¨ ì„œë¹„ìŠ¤</li>`;
  } else if(["ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©","ë³µì§€Â·ìƒí™œì§€ì›ê¸ˆ"].includes(data.topic)){
    extraCard.style.display = "block";
    extraTitle.innerText = "ğŸ“˜ AI ì‹¤í–‰ ê°€ì´ë“œ";
    extraList.innerHTML = data.topic === "ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©" ?
      `<li>ğŸ“± ìŠ¤ë¯¸ì‹± ì°¨ë‹¨ ì•± ì„¤ì¹˜ ë° ì•Œ ìˆ˜ ì—†ëŠ” ë§í¬ ê¸ˆì§€</li>
       <li>ğŸ¦ ê¸ˆìœµê¸°ê´€ ì‚¬ì¹­ ì „í™” ì¦‰ì‹œ ì°¨ë‹¨ ë° ì‹ ê³ </li>
       <li>ğŸ’¬ ìµœê·¼ ë³´ì´ìŠ¤í”¼ì‹± ìœ í˜•: ì§€ì›ê¸ˆÂ·íƒë°° ì‚¬ì¹­ ë©”ì‹œì§€</li>` :
      `<li>ğŸ’° ë³µì§€ë¡œ / ì •ë¶€24ì—ì„œ ë³¸ì¸ ìê²© ì¦‰ì‹œ ì¡°íšŒ</li>
       <li>ğŸ¢ ì£¼ë¯¼ì„¼í„° ë°©ë¬¸ ì‹œ ì‹ ë¶„ì¦ í•„ìˆ˜</li>
       <li>ğŸ“… ì‹ ì²­ ë§ˆê°ì¼ í™•ì¸ í›„ ì œì¶œ í•„ìš”</li>`;
  }

})();
</script>
</body>
</html>
