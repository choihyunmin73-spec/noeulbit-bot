<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI ì¢…í•© ë¶„ì„ ê²°ê³¼</title>
  <style>
    body {
      background-color: #f8fafc;
      font-family: "Noto Sans KR", sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      display: flex;
      gap: 20px;
      margin: 40px auto;
      width: 90%;
      max-width: 1200px;
    }
    .left, .right {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.05);
      padding: 25px;
    }
    .left {
      flex: 1;
      max-width: 350px;
    }
    .right {
      flex: 2;
    }
    h2 {
      color: #1e293b;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .affiliate-item {
      display: flex;
      align-items: center;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      transition: 0.2s;
      cursor: pointer;
    }
    .affiliate-item:hover {
      background-color: #f1f5f9;
    }
    .affiliate-item img {
      width: 45px;
      height: 45px;
      border-radius: 8px;
      margin-right: 12px;
      background: #f1f5f9;
    }
    .affiliate-info {
      text-align: left;
    }
    .affiliate-info .name {
      font-weight: 600;
      color: #0f172a;
      font-size: 15px;
    }
    .affiliate-info .desc {
      font-size: 13px;
      color: #64748b;
    }
    .section {
      margin-bottom: 25px;
    }
    .result-box {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }
    .progress-bar {
      width: 100%;
      height: 16px;
      border-radius: 10px;
      background: #e2e8f0;
      margin: 10px 0;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      border-radius: 10px;
      background: linear-gradient(90deg, #3b82f6, #2563eb);
      width: 0;
      transition: width 1.2s ease;
    }
    .ai-opinion {
      background-color: #eff6ff;
      border-left: 4px solid #2563eb;
      padding: 12px;
      border-radius: 6px;
      color: #1e3a8a;
      font-size: 14px;
    }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }
    button:hover {
      background-color: #1e40af;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ì¢Œì¸¡ ì œíœ´ìƒí’ˆ -->
    <div class="left">
      <h2>ì¶”ì²œ ì œíœ´ìƒí’ˆ</h2>
      <div id="affiliateList">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- ìš°ì¸¡ ë¶„ì„ê²°ê³¼ -->
    <div class="right">
      <h2>AI ì¢…í•© ë¶„ì„ ê²°ê³¼</h2>
      <div id="resultBox" class="result-box">ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      <div class="button-group">
        <button id="linkBtn">ê´€ë ¨ ì„œë¹„ìŠ¤ ë°”ë¡œê°€ê¸°</button>
        <button onclick="goHome()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
    </div>
  </div>

  <script>
    const result = JSON.parse(localStorage.getItem("aiResult"));
    const resultBox = document.getElementById("resultBox");
    const affiliateList = document.getElementById("affiliateList");
    const linkBtn = document.getElementById("linkBtn");

    if (!result) {
      resultBox.innerHTML = "âŒ ê²°ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    } else {
      const { topic, risk, level, detail, summary, opinion } = result;

      const riskLabel = level === "mild" ? "ë‚®ìŒ" : level === "moderate" ? "ë³´í†µ" : "ë†’ìŒ";
      const progressValue = level === "mild" ? 35 : level === "moderate" ? 65 : 90;

      resultBox.innerHTML = `
        <p><strong>[${topic}]</strong> ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.</p>
        <div class="progress-bar"><div class="progress" id="progress"></div></div>
        <p>ìœ„í—˜ë„: <strong>${riskLabel}</strong> (${risk}%)</p>
        <hr/>
        <div class="section">
          <h3>ğŸ” ìƒì„¸ ì§„ë‹¨</h3>
          <ul>${detail.map(d => `<li>${d}</li>`).join("")}</ul>
        </div>
        <div class="section">
          <h3>ğŸ“„ ìš”ì•½ ì •ë¦¬</h3>
          <ul>${summary.map(s => `<li>${s}</li>`).join("")}</ul>
        </div>
        <div class="section ai-opinion">
          <strong>ğŸ’¬ AI ì˜ê²¬:</strong><br>${opinion.join("<br>")}
        </div>
      `;

      // âœ… ê·¸ë˜í”„ ì• ë‹ˆë©”ì´ì…˜
      setTimeout(() => {
        document.getElementById("progress").style.width = `${progressValue}%`;
      }, 200);
    }

    // âœ… affiliate.json ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("/affiliate.json")
      .then(res => res.json())
      .then(data => {
        affiliateList.innerHTML = "";
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "affiliate-item";
          div.innerHTML = `
            <img src="${item.image}" alt="ìƒí’ˆ" />
            <div class="affiliate-info">
              <div class="name">${item.name}</div>
              <div class="desc">${item.desc}</div>
            </div>
          `;
          affiliateList.appendChild(div);
        });
      })
      .catch(() => {
        affiliateList.innerHTML = "âŒ ì œíœ´ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      });

    // âœ… ê´€ë ¨ CTA ë²„íŠ¼ ì„¤ì •
    linkBtn.onclick = () => {
      if (result.topic.includes("ìë™ì°¨")) {
        window.open("https://www.carcompare.co.kr", "_blank");
      } else if (result.topic.includes("ë³´í—˜")) {
        window.open("https://www.insureplan.co.kr", "_blank");
      } else {
        window.open("https://noeulbitharu.kr", "_blank");
      }
    };

    function goHome() {
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
