<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>노을빛하루 AI 진단 결과</title>
<style>
  :root{
    --bg:#0d1420;--panel:#182539;--panel2:#121a2a;--border:#294e80;
    --text:#e1ecff;--muted:#9fb1cc;--accent:#6ba7ff;--chip:#22324b;
  }
  body{margin:0;background:var(--bg);color:var(--text);font-family:"Pretendard","Noto Sans KR",sans-serif}
  h1{margin:32px 0 8px;text-align:center;color:var(--accent);font-size:32px}
  .wrap{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;padding:0 20px 40px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.35);padding:22px;min-width:380px;max-width:680px;flex:1}
  .side{max-width:520px}
  .hl{border-left:4px solid var(--accent);padding-left:10px;margin:4px 0 14px 0}
  .level{color:#cdd8ff;margin:6px 0 10px}
  .bar{height:8px;background:#243351;border-radius:4px;overflow:hidden;margin:8px 0 10px}
  .bar>span{display:block;height:100%;background:var(--accent);width:0;transition:width .8s}
  .section{color:#aecdff;margin:18px 0 8px;border-left:3px solid var(--accent);padding-left:8px}
  ul{margin:6px 0 10px 18px}
  li{margin:4px 0}
  .muted{color:var(--muted)}
  .pill{display:flex;gap:12px;flex-direction:column}
  .aff{display:flex;gap:12px;align-items:flex-start;background:#1d2a41;border:1px solid #2a3d5f;border-radius:12px;padding:14px;cursor:pointer;transition:.15s}
  .aff:hover{transform:translateY(-2px);background:#213454}
  .aff img{width:28px;height:28px}
  .btns{display:flex;gap:10px;margin-top:14px}
  button{background:var(--accent);color:#fff;border:0;border-radius:8px;padding:10px 16px;cursor:pointer}
  button.secondary{background:#314869}
  @media (max-width:600px){.card{min-width:320px}}
</style>
</head>
<body>
  <h1>노을빛하루 AI 진단 결과</h1>

  <div class="wrap">
    <!-- LEFT -->
    <section class="card">
      <h2 class="hl" id="topic">주제</h2>
      <div class="level" id="level">mild</div>
      <div class="bar"><span id="riskBar"></span></div>
      <div class="muted"><strong>위험도 지표:</strong> <span id="risk">0</span>/100</div>

      <h3 class="section">상세 진단</h3>
      <p id="detail" class="muted">불러오는 중…</p>

      <h3 class="section">요약</h3>
      <ul id="summary"><li class="muted">요약 데이터 없음</li></ul>

      <h3 class="section">전문가 의견</h3>
      <ul id="opinion"><li class="muted">전문가 의견 데이터 없음</li></ul>

      <div class="btns">
        <button onclick="goHome()">처음으로</button>
        <button class="secondary" onclick="retry()">다시 진단</button>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card side">
      <h2 class="hl">제휴상품 (필요하신 영양제)</h2>
      <div id="supps" class="pill"></div>

      <h2 class="section">제휴보험 (체크해 보세요)</h2>
      <div id="ins" class="pill"></div>
    </aside>
  </div>

<script>
(function(){
  // 1) 입력값 불러오기
  const topic = localStorage.getItem("aiTopic");
  const answers = JSON.parse(localStorage.getItem("aiAnswers")||"[]");
  const $ = id => document.getElementById(id);

  if(!topic){ $("topic").textContent="주제 정보 없음"; $("detail").textContent="이전 단계 데이터가 없습니다."; return; }

  $("topic").textContent = topic;

  // 2) 간단 스코어링
  const riskWords = ["심함","매우","악화","위험","불편","저림","통증","숨","가슴","두근","어려움","높음","수면제","불규칙"];
  let riskScore = 0;
  answers.forEach(a => riskWords.forEach(w => { if(a.includes(w)) riskScore++; }));
  // 주제별 가중(가슴/호흡 관련은 좀 더 민감)
  if(/심장|호흡|가슴/.test(topic)) riskScore = Math.round(riskScore*1.3);

  const riskPercent = Math.max(0, Math.min(100, Math.round((riskScore/ (answers.length||1)) * 18))); // 0~100
  $("risk").textContent = riskPercent;
  $("riskBar").style.width = riskPercent + "%";

  let level="mild";
  if(riskPercent>=66) level="high";
  else if(riskPercent>=33) level="moderate";
  $("level").textContent = level;

  // 3) 상세진단(3~5줄), 요약(3개), 전문가 의견(3개) 생성
  const mk = {
    detail(t){ // 3~5줄
      const lines = [];
      if(t==="어깨·목 통증"){
        lines.push("현재 증상은 근육 긴장 및 자세 습관과 연관성이 높습니다.");
        lines.push("장시간 컴퓨터·스마트폰 사용이 누적되면 통증, 뻣뻣함, 저림이 반복될 수 있습니다.");
        lines.push("열·온찜질과 가벼운 스트레칭으로 단기 완화가 가능하며, 수면 환경 점검이 도움됩니다.");
        lines.push("강한 통증이 지속되거나 팔 저림/근력저하가 동반되면 정형외과·신경과 상담을 권장합니다.");
      } else if(t==="혈압 관리"){
        lines.push("최근 응답을 보면 식습관·운동·복약 순응도가 혈압 변동에 영향을 주고 있습니다.");
        lines.push("나트륨 섭취와 수면의 질은 혈압의 일중 변동을 키우는 핵심 요인입니다.");
        lines.push("자가 혈압 측정 빈도를 높이고 기록을 남기면 약 조정과 생활교정에 큰 도움이 됩니다.");
      } else if(t==="혈당·당뇨"){
        lines.push("식후 피로·졸림 응답이 있어 혈당 스파이크 가능성이 시사됩니다.");
        lines.push("단 음식·정제탄수 위주 식단과 운동 부족은 인슐린 저항성을 높일 수 있습니다.");
        lines.push("식사 순서(채소→단백질→탄수)와 식후 걷기가 단기 개선에 효과적입니다.");
      } else if(t==="불면증·수면장애"){
        lines.push("입면 지연/야간 각성 응답이 있어 수면 위생 개선이 우선입니다.");
        lines.push("취침 2시간 전 밝은 화면, 카페인·야식은 수면 구조를 흔듭니다.");
        lines.push("규칙적 기상·단계적 이완·실내 조도 관리가 도움이 됩니다.");
      } else if(t==="심장·호흡·가슴통증"){
        lines.push("운동·휴식 상황에서의 가슴 불편 응답이 있어 원인 구분이 필요합니다.");
        lines.push("호흡곤란/심계항진이 동반되면 심폐 평가가 권장됩니다.");
        lines.push("압박감·식은땀·왼쪽 방사통이 있으면 즉시 진료가 필요합니다.");
      } else if(t==="노안·시력저하"){
        lines.push("가까운 거리 초점 불편·눈 피로가 반복되는 양상입니다.");
        lines.push("건조/눈부심 응답은 작업 조도·화면 사용 습관과 연관됩니다.");
        lines.push("정기 안과 검진과 눈 건강 영양 보강을 병행하세요.");
      } else if(t==="치매·기억력 문제"){
        lines.push("가벼운 건망 응답이라면 정상 노화 범주일 수 있습니다.");
        lines.push("일상 기능 저하·길 잃음·최근 사건 기억 상실은 평가가 필요합니다.");
        lines.push("수면·우울·갑상선·비타민D/B12도 인지에 영향을 줍니다.");
      } else if(t==="전립선·배뇨 문제"){
        lines.push("야간뇨/잔뇨감·급박뇨 응답이 배뇨 불편에 기여합니다.");
        lines.push("수분 섭취 패턴·카페인이 증상을 악화시킬 수 있습니다.");
        lines.push("PSA/소변검사·초음파 등 비뇨기 평가를 고려하세요.");
      } else if(t==="관절 통증"){
        lines.push("부하 활동·계단에서 악화되는 통증은 연골·인대 부담 신호일 수 있습니다.");
        lines.push("체중·근력·균형이 관절 통증의 핵심 변인입니다.");
        lines.push("RICE(휴식·냉찜질)와 점진적 근력운동이 권장됩니다.");
      } else if(t==="복지·생활지원금"){
        lines.push("응답 기준으로 서류·소득·가구원 요건 확인이 우선입니다.");
        lines.push("복지로/정부24 사전 자격 조회 후 필요 증빙을 준비하세요.");
        lines.push("중복수급/환수 이슈를 피하려면 담당센터 상담을 권합니다.");
      } else if(t==="보험비용 종합점검"){
        lines.push("중복 특약·갱신형 비중이 보험료 상승의 주요 요인입니다.");
        lines.push("보장 공백은 실손/진단금 구성을 재정렬해 메울 수 있습니다.");
        lines.push("해지 전 대체 설계 비교 후 단계 전환이 안전합니다.");
      } else if(t==="자동차 견적·보험비용 점검"){
        lines.push("예산·주행거리·보유기간에 따라 현금/할부/렌트·리스 효율이 달라집니다.");
        lines.push("자차담보/긴급출동/자기부담금 등 특약 최적화로 보험료를 절감할 수 있습니다.");
        lines.push("비교 견적 3사 이상 확인이 체감비용을 낮춥니다.");
      } else {
        lines.push("응답을 바탕으로 기본 분석을 완료했습니다.");
      }
      return lines.join("\n");
    },
    summary(t, lvl){ // 3 bullets
      const base = [];
      if(lvl==="high") base.push("증상 강도가 높아 단기 모니터링이 필요합니다.");
      else if(lvl==="moderate") base.push("경도~중등의 주의가 필요합니다.");
      else base.push("현재 전반 상태는 비교적 안정적입니다.");
      base.push("생활 습관(수면·식단·운동) 조정이 증상 완화에 도움이 됩니다.");
      base.push(`${t} 관련 체크리스트를 1~2주 기록해 변동 패턴을 확인하세요.`);
      return base;
    },
    advice(t,lvl){ // 3 bullets
      const arr=[];
      if(/어깨·목/.test(t)) arr.push("매 45~60분마다 1~2분 자세 리셋, 목·견갑 스트레칭.");
      if(/혈압/.test(t)) arr.push("아침·저녁 혈압을 1주 기록하고 평균/변동폭 확인.");
      if(/혈당|당뇨/.test(t)) arr.push("식후 10~15분 걷기 및 탄수 섭취 순서 조절.");
      if(/불면/.test(t)) arr.push("취침 2시간 전 화면·카페인·과식 제한, 동일 기상 시각 유지.");
      if(/심장|가슴|호흡/.test(t)) arr.push("가슴 압박·방사통·식은땀 동반 시 즉시 진료.");
      if(/노안|시력/.test(t)) arr.push("작업 조도·휴식 20-20-20 규칙 및 정기 안과검진.");
      if(/전립선|배뇨/.test(t)) arr.push("저녁 이후 카페인·수분 조절, 비뇨기 상담 고려.");
      if(/관절/.test(t)) arr.push("통증 범위 내 등속성 근력운동 + 체중 관리.");
      if(/보험비용/.test(t)) arr.push("중복 특약/갱신 비중 점검 후 필요보장 위주 재편.");
      if(/자동차/.test(t)) arr.push("주행거리·잔가 반영한 렌트/리스 vs 현금 총소유비 비교.");
      // 채우기(정확히 3개 보장)
      while(arr.length<3) arr.push("증상 악화·이상 신호 발생 시 전문의 상담을 권장합니다.");
      return arr.slice(0,3);
    }
  };

  $("detail").textContent = mk.detail(topic);
  $("summary").innerHTML = mk.summary(topic, level).slice(0,3).map(s=>`<li>${s}</li>`).join("");
  $("opinion").innerHTML = mk.advice(topic, level).slice(0,3).map(s=>`<li>${s}</li>`).join("");

  // 4) affiliate.json 로드
  fetch("/affiliate.json")
    .then(r=>r.json())
    .then(map=>{
      const list = map[topic] || [];
      const supps = $("supps");
      if(!list.length){
        supps.innerHTML = `<div class="muted">해당 주제에 등록된 제휴상품이 없습니다.</div>`;
        return;
      }
      list.forEach(item=>{
        const div = document.createElement("div");
        div.className="aff";
        div.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/2965/2965567.png" alt="pill">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.desc||""}</div>
            <div class="muted">쿠팡 바로가기</div>
          </div>`;
        div.onclick = ()=>window.open(item.link,"_blank");
        supps.appendChild(div);
      });
    })
    .catch(()=>{$("supps").innerHTML=`<div class="muted">제휴상품 정보를 불러오지 못했습니다.</div>`});

  // 5) 보험(고정 2종)
  const ins = $("ins");
  [
    {name:"고혈압·심장 보장보험",desc:"혈압·심혈관 중심 보장 상품"},
    {name:"만성질환 실손보험",desc:"정기 내과·검사비 보장 상품"}
  ].forEach(i=>{
    const div=document.createElement("div");
    div.className="aff";
    div.innerHTML=`<img src="https://cdn-icons-png.flaticon.com/512/2965/2965401.png" alt="shield">
      <div><div><strong>${i.name}</strong></div><div class="muted">${i.desc}</div></div>`;
    ins.appendChild(div);
  });

  // 6) 네비게이션
  window.goHome = function(){ localStorage.clear(); location.href="index.html"; }
  window.retry   = function(){ localStorage.removeItem("aiAnswers"); location.href = `question.html?topic=${encodeURIComponent(topic)}`; }
})();
</script>
</body>
</html>
