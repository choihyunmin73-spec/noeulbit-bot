<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>AI 진단 결과</title>
<style>
  :root{--bg:#0d1420;--panel:#121a26;--panel2:#182235;--line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;}
  body{font-family:"Pretendard","Noto Sans KR",sans-serif;background:var(--bg);color:var(--white);margin:0}
  .wrap{max-width:1180px;margin:0 auto;padding:26px 32px 40px}
  h1{margin:6px 0 18px;color:#98c2ff}
  .grid{display:grid;grid-template-columns:1.7fr .9fr;gap:26px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:18px}
  .chip{display:inline-block;background:#1f2b44;border:1px solid #2f4570;padding:6px 10px;border-radius:999px;font-size:13px;color:#cfe2ff;margin-right:8px}
  .bar{height:8px;border-radius:4px;background:#23304a;overflow:hidden;margin-top:8px}
  .bar>span{display:block;height:100%;width:0;background:#6ba7ff;transition:width .6s}
  h3.sec{color:#9eb2ff;border-left:3px solid var(--brand);padding-left:8px;margin:18px 0 8px}
  ul{margin:8px 0 12px 20px}
  li{margin:4px 0}
  .twoBtn{display:flex;gap:12px;margin-top:16px}
  .btn{display:inline-block;background:#294e80;border:1px solid #3d6bb0;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none}
  /* 오른쪽 */
  .aff{display:flex;align-items:flex-start;gap:12px;background:#1f2531;border:1px solid #283142;border-radius:12px;padding:14px;cursor:pointer;transition:.2s;margin-bottom:12px}
  .aff:hover{transform:translateY(-2px);background:#232c3d}
  .aff img{width:26px;height:26px}
  .muted{color:#98a0b3}
  .tiny{font-size:12px;color:#8c95a8;margin-top:6px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <h1>AI 진단 결과</h1>
    <div class="grid">
      <!-- LEFT -->
      <section class="card" id="left">
        <div class="chip" id="topic">주제: 알 수 없음</div>
        <div class="chip" id="level">mild</div>
        <div class="chip">총 응답 수: <span id="ans">0</span></div>
        <div class="chip">위험단어 수: <span id="rk">0</span></div>
        <div class="chip">위험도 지표: <span id="risk">0</span>/100</div>
        <div class="bar"><span id="riskBar"></span></div>

        <h3 class="sec">상세 진단</h3>
        <ul id="detail"></ul>

        <h3 class="sec">요약</h3>
        <ul id="summary"></ul>

        <h3 class="sec">전문가 의견</h3>
        <ul id="opinion"></ul>

        <div class="twoBtn">
          <a class="btn" href="index.html">처음으로 돌아가기</a>
          <a class="btn" href="question.html">다시 진단하기</a>
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="card" id="right">
        <h3 class="sec">제휴상품 (필요하신 영양제)</h3>
        <div id="supps"></div>
        <div class="tiny">본 제휴상품 및 제휴보험은 소정의 수수료를 지급받습니다.</div>

        <h3 class="sec">제휴보험 (체크해 보세요)</h3>
        <div id="ins"></div>
      </aside>
    </div>
  </div>

<script>
(function(){
  const res = JSON.parse(localStorage.getItem("aiResult")||"null");
  const topic = localStorage.getItem("aiTopic") || "알 수 없음";
  const $ = id => document.getElementById(id);

  if(!res){
    $("detail").innerHTML = `<li class="muted">결과 데이터를 불러오지 못했습니다.</li>`;
    return;
  }

  $("topic").textContent = `주제: ${res.topic||topic}`;
  $("level").textContent = res.level||"mild";
  $("ans").textContent = res.answerCount ?? 0;
  $("rk").textContent = res.riskWordCount ?? 0;
  $("risk").textContent = res.riskPercent ?? 0;
  $("riskBar").style.width = ((res.riskPercent ?? 0) + "%");

  // 상세 15줄
  const det = Array.isArray(res.detail)? res.detail : [];
  $("detail").innerHTML = det.length ? det.map(s=>`<li>${s}</li>`).join("") : `<li class="muted">상세 진단 데이터가 없습니다.</li>`;

  // 요약 7줄
  const sum = Array.isArray(res.summary)? res.summary : [];
  $("summary").innerHTML = sum.length ? sum.map(s=>`<li>${s}</li>`).join("") : `<li class="muted">요약 데이터 없음</li>`;

  // 전문가 의견 2줄
  const opn = Array.isArray(res.opinion)? res.opinion : [];
  $("opinion").innerHTML = opn.length ? opn.map(s=>`<li>${s}</li>`).join("") : `<li class="muted">전문가 의견 데이터 없음</li>`;

  // 제휴상품 (항상 최신 불러오기)
  fetch("/affiliate-live")
    .then(r=>r.json())
    .then(map=>{
      const list = map[res.topic] || map[topic] || [];
      const box = $("supps");
      if(!list.length){
        box.innerHTML = `<div class="muted">해당 주제에 등록된 제휴상품이 없습니다.</div>`;
        return;
      }
      box.innerHTML = "";
      list.slice(0,3).forEach(item=>{
        const d = document.createElement("div");
        d.className = "aff";
        d.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/2965/2965567.png" alt="pill">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.desc||""}</div>
            <div class="muted">쿠팡 바로가기</div>
          </div>`;
        d.onclick = ()=>window.open(item.link,"_blank");
        box.appendChild(d);
      });
    })
    .catch(()=>{$("supps").innerHTML=`<div class="muted">제휴상품 정보를 불러오지 못했습니다.</div>`});

  // 제휴보험(고정 2종)
  const ins = $("ins");
  [
    {name:"고혈압·심장 보장보험", desc:"혈압·심혈관질환 중심 보장 상품"},
    {name:"만성질환 실손보험",   desc:"정기 내과·검사비 보장 상품"}
  ].forEach(i=>{
    const d = document.createElement("div");
    d.className = "aff";
    d.innerHTML = `
      <img src="https://cdn-icons-png.flaticon.com/512/2965/2965401.png" alt="shield">
      <div>
        <div><strong>${i.name}</strong></div>
        <div class="muted">${i.desc}</div>
      </div>`;
    ins.appendChild(d);
  });
})();
</script>
</body>
</html>
