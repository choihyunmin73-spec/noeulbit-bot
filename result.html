<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ì§„ë‹¨ ê²°ê³¼</title>

<style>
body {
    margin:0;
    background:#f4f6fb;
    font-family:'Noto Sans KR',sans-serif;
}
.wrap {
    max-width:920px;
    margin:25px auto;
}
.card {
    background:white;
    padding:26px;
    border-radius:16px;
    box-shadow:0 5px 16px rgba(0,0,0,0.08);
    margin-bottom:20px;
}
.title {
    font-size:24px;
    font-weight:800;
    margin-bottom:10px;
}
.sub {
    color:#6b7280;
    font-size:15px;
    margin-bottom:15px;
}
.pill {
    display:inline-block;
    background:#eef2ff;
    padding:7px 13px;
    border-radius:999px;
    margin:4px 6px 6px 0;
    font-size:13px;
    color:#3742b1;
}
.pill.red { background:#ffe7e7; color:#b91c1c; }
.pill.amber { background:#fff3cd; color:#b54706; }

.bar {
    background:#e5e7eb;
    border-radius:999px;
    overflow:hidden;
    margin-top:10px;
    height:14px;
}
.bar-fill {
    background:#2563eb;
    height:100%;
    transition:width 0.8s;
}

h3 {
    font-size:19px;
    margin:18px 0 10px;
}
li {
    font-size:16px;
    margin-bottom:6px;
    line-height:1.45;
}
.btn {
    background:#2f6efc;
    color:white;
    padding:18px;
    border-radius:12px;
    text-align:center;
    font-size:18px;
    cursor:pointer;
    margin-top:18px;
}
@media(max-width:480px){
    .wrap{margin:15px;}
    .card{padding:20px;}
    .title{font-size:22px;}
    h3{font-size:18px;}
    li{font-size:15px;}
}
</style>
</head>

<body>

<div class="wrap">
    <!-- âœ… í—¤ë” -->
    <div class="card">
        <div class="title">ğŸ’  ë…¸ì„ë¹›í•˜ë£¨ AI ë¶„ì„ ê²°ê³¼</div>
        <div class="sub">ì…ë ¥í•˜ì‹  ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ì¢…í•© ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</div>

        <div id="pills"></div>
        <div id="summary" style="margin-top:15px;"></div>

        <div class="bar"><div id="barFill" class="bar-fill" style="width:0%;"></div></div>
        <div style="font-size:14px;color:#374151;margin-top:6px;">ì˜ˆìƒ ìœ„í—˜ë„: <span id="percentTxt">0%</span></div>
    </div>

    <!-- âœ… AI ìš”ì•½ -->
    <div class="card">
        <h3>ğŸ¤– AI ì¢…í•© ë¶„ì„</h3>
        <div id="aiSummary" style="font-size:16px;line-height:1.6;color:#374151;"></div>
    </div>

    <!-- âœ… ì…€í”„ ì¼€ì–´ -->
    <div class="card">
        <h3>âœ… ì…€í”„ ì¼€ì–´ ê°€ì´ë“œ</h3>
        <ul id="tips"></ul>
    </div>

    <!-- âœ… ìœ„í—˜ ì‹ í˜¸ -->
    <div class="card">
        <h3>âš ï¸ ìœ„í—˜ ì‹ í˜¸</h3>
        <ul id="redflags"></ul>
        <div id="rfNote" style="color:#d62828;font-size:14px;margin-top:8px;"></div>
    </div>

    <!-- âœ… ì„ íƒ í•­ëª© -->
    <div class="card">
        <h3>ğŸ§¾ ì„ íƒí•œ í•­ëª©</h3>
        <div id="selected"></div>
    </div>

    <!-- âœ… ë‹¤ì‹œí•˜ê¸° -->
    <div class="btn" onclick="location.href='/'">â† ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</div>
</div>

<script>
(function(){
    const params = new URLSearchParams(location.search);
    const raw = params.get("payload");
    let data = {};
    try {
        data = JSON.parse(decodeURIComponent(raw));
    } catch(e) {
        console.error("âŒ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜", e);
        document.body.innerHTML = "<p style='padding:20px;'>âš ï¸ ê²°ê³¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
    }

    // âœ… ìƒ‰ìƒ í´ë˜ìŠ¤ ì„¤ì •
    const sevClass = 
        data.severity === "ë†’ìŒ" ? "red" :
        data.severity === "ì¤‘ê°„" ? "amber" : "";

    // âœ… ì •ë³´ì¹©
    const pills = [
        `<span class="pill">ì£¼ì œ: ${data.topic}</span>`,
        `<span class="pill ${sevClass}">ìœ„í—˜ë„: ${data.severity}</span>`,
        `<span class="pill">ê¶Œì¥ ì§„ë£Œê³¼: ${data.dept}</span>`
    ];
    document.getElementById("pills").innerHTML = pills.join(" ");

    // âœ… ìš”ì•½
    document.getElementById("summary").innerHTML =
        `<b>ê¶Œì¥ ì¡°ì¹˜:</b> ${data.action}`;

    // âœ… í¼ì„¼íŠ¸ë°”
    const percent = data.percent || 0;
    document.getElementById("barFill").style.width = percent + "%";
    document.getElementById("percentTxt").textContent = percent + "%";

    // âœ… AI ìš”ì•½
    document.getElementById("aiSummary").textContent = data.aiSummary || "ë¶„ì„ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";

    // âœ… ì…€í”„ ì¼€ì–´
    const tips = data.tips || [];
    document.getElementById("tips").innerHTML = tips.length
        ? tips.map(t => `<li>${t}</li>`).join("")
        : "<li>ì¶”ì²œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";

    // âœ… ìœ„í—˜ ì‹ í˜¸
    const rf = data.redflags || [];
    document.getElementById("redflags").innerHTML = rf.length
        ? rf.map(r => `<li>${r}</li>`).join("")
        : "<li>íŠ¹ë³„í•œ ì‘ê¸‰ ì‹ í˜¸ëŠ” ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</li>";

    if (rf.length > 0)
        document.getElementById("rfNote").textContent =
            "â€» ìœ„ ì¦ìƒì´ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ 119 ë˜ëŠ” ê°€ê¹Œìš´ ì‘ê¸‰ì‹¤ë¡œ ë°©ë¬¸í•˜ì„¸ìš”.";

    // âœ… ì„ íƒ í•­ëª©
    const checks = data.checks || [];
    document.getElementById("selected").innerHTML =
        checks.map(c => `<span class="pill">${c}</span>`).join(" ");
})();
</script>
</body>
</html>
