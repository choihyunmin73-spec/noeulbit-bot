<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ì¢…í•© ì§„ë‹¨ ê²°ê³¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --bg:#f5f7fb; --card:#fff; --shadow:0 6px 18px rgba(0,0,0,.07);
    --text:#111827; --muted:#6b7280; --brand:#2f6efc;
    --border:#c9d2f0;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text)}
  .container{max-width:1320px;margin:28px auto;display:flex;gap:20px;padding:0 14px;flex-wrap:nowrap;}
  .left{flex:2;background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:28px;}
  .right{flex:1;background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:24px;}
  .title{font-weight:800;font-size:24px;margin:0 0 8px;}
  .sub{color:var(--muted);font-size:15px;margin:0 0 20px;}
  .result-box{border:2px solid var(--border);border-radius:12px;padding:24px;display:flex;align-items:flex-start;justify-content:flex-start;gap:24px;margin-bottom:24px;flex-wrap:nowrap;}
  .result-chart{width:240px!important;height:240px!important;flex-shrink:0;}
  .result-detail{flex:1;word-break:keep-all;white-space:normal;line-height:1.7;font-size:15.5px;color:#333;}
  .section{margin-top:26px;}
  .section h3{font-size:18px;margin:0 0 12px;border-left:6px solid var(--brand);padding-left:10px;}
  ul.clean{list-style:none;margin:0;padding-left:10px;}
  ul.clean li{margin:6px 0;line-height:1.6;}
  .btn{margin-top:18px;background:var(--brand);color:#fff;border:none;border-radius:12px;padding:16px 18px;font-size:17px;cursor:pointer;width:100%;}
  .aff-title{color:#1e40af;font-size:18px;margin:0 0 12px;}
  .card{border:1px solid #e5e7eb;border-radius:12px;padding:14px;margin-bottom:14px;transition:.2s;}
  .card:hover{background:#f0f4ff;border-color:#9db0ff;}
  .card img{width:100%;height:180px;object-fit:cover;border-radius:10px;margin-bottom:10px;background:#eef1f9;}
  .card a{color:#1e3a8a;text-decoration:none;font-weight:700;}
  .card .desc{font-size:14px;color:#4b5563;margin-top:4px;}
  .ins{margin-top:22px;padding-top:16px;border-top:1px solid #e5e7eb;}
  .ins h3{border-left:5px solid #10b981;padding-left:10px;color:#065f46;font-size:17px;margin:0 0 10px;}
  .ins .card{background:#ecfdf5;border-color:#cfe8e1;}
  .ins .card a{color:#047857;}

  /* âœ… ë°˜ì‘í˜• (í•¸ë“œí° ìµœì í™”) */
  @media (max-width:1000px){
    .container{flex-direction:column;}
    .result-box{flex-direction:column;align-items:center;}
    .result-chart{width:200px!important;height:200px!important;}
    .result-detail{width:100%;text-align:left;font-size:15px;}
    .right{width:100%;margin-top:20px;}
  }

  @media (max-width:600px){
    body{font-size:14px;}
    .result-detail{font-size:14.5px;line-height:1.6;}
    .card img{height:140px;}
    /* âœ… ì œíœ´ìƒí’ˆ 2ì—´ ê·¸ë¦¬ë“œ */
    #affList, #insList{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }
    .card{margin-bottom:0;padding:10px;}
  }
</style>
</head>
<body>

<div class="container">
  <!-- LEFT -->
  <div class="left">
    <h1 class="title">ğŸ’  ë…¸ì„ë¹›í•˜ë£¨ AI ì¢…í•© ì§„ë‹¨ ê²°ê³¼</h1>
    <p class="sub">AI ë¶„ì„ ê¸°ë°˜ìœ¼ë¡œ ê°œì¸ ë§ì¶¤í˜• ìƒíƒœë¥¼ ìš”ì•½í•©ë‹ˆë‹¤.</p>

    <div class="result-box">
      <canvas id="riskChart" class="result-chart" aria-label="ìœ„í—˜ë„ ê·¸ë˜í”„"></canvas>
      <div id="detail" class="result-detail"></div>
    </div>

    <section class="section">
      <h3>AI ì¢…í•© ì§„ë‹¨ ìš”ì•½</h3>
      <ul id="summary" class="clean"></ul>
    </section>

    <section class="section">
      <h3>ì¢…í•© ì˜ê²¬</h3>
      <p id="opinion" style="margin:0"></p>
    </section>

    <button class="btn" onclick="location.href='/'">â† ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</button>
  </div>

  <!-- RIGHT -->
  <aside class="right">
    <h3 class="aff-title">ì¶”ì²œ ì œíœ´ìƒí’ˆ</h3>
    <div id="affList"></div>

    <div class="ins">
      <h3>ì¶”ì²œ ë³´í—˜ ì œíœ´ ì„œë¹„ìŠ¤</h3>
      <div id="insList"></div>
    </div>
  </aside>
</div>

<script>
const qs = new URLSearchParams(location.search);
const payloadStr = qs.get("payload");
let topicParam = qs.get("topic");
let payload = null;
if (payloadStr) {
  try { payload = JSON.parse(decodeURIComponent(payloadStr)); } catch {}
}
const TOPIC = (payload && payload.topic) || topicParam || "ê´€ì ˆ í†µì¦";

/* ìœ„í—˜ë„ ì„¤ì • */
const riskConfig = {
  "ê´€ì ˆ í†µì¦": { percent:86,color:"#f97316" },
  "í˜ˆì•• ê´€ë¦¬": { percent:78,color:"#ef4444" },
  "í˜ˆë‹¹Â·ë‹¹ë‡¨": { percent:74,color:"#dc2626" },
  "ë¶ˆë©´ì¦Â·ìˆ˜ë©´ì¥ì• ": { percent:62,color:"#eab308" },
  "ì–´ê¹¨Â·ëª© í†µì¦": { percent:69,color:"#fb923c" },
  "ì‹¬ì¥Â·í˜¸í¡Â·ê°€ìŠ´í†µì¦": { percent:88,color:"#b91c1c" },
  "ë…¸ì•ˆÂ·ì‹œë ¥ì €í•˜": { percent:55,color:"#06b6d4" },
  "ì¹˜ë§¤Â·ê¸°ì–µë ¥ ë¬¸ì œ": { percent:72,color:"#9333ea" },
  "ì „ë¦½ì„ Â·ë°°ë‡¨ ë¬¸ì œ": { percent:67,color:"#2563eb" },
  "ì¢…í•© ê±´ê°• ì²´í¬": { percent:58,color:"#14b8a6" },
  "ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°©": { percent:83,color:"#0ea5e9" },
  "ë³µì§€Â·ìƒí™œì§€ì›ê¸ˆ": { percent:64,color:"#10b981" }
};

/* ìƒì„¸ ì„¤ëª… ìƒ˜í”Œ */
const detailTemplates={
  "ê´€ì ˆ í†µì¦":[
    "ì´ˆê¸° ê´€ì ˆì—¼ ì˜ì‹¬ ë‹¨ê³„ë¡œ í‰ê°€ë©ë‹ˆë‹¤.",
    "ê³„ë‹¨ ì˜¤ë¥´ë‚´ë¦¬ê¸°Â·ì¥ì‹œê°„ ë³´í–‰ì—ì„œ í†µì¦ì´ ì•…í™”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "ì•„ì¹¨ ë»£ë»£í•¨ê³¼ êµ­ì†Œ ì••í†µì´ ë°˜ë³µë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
    "ì—°ê³¨ ë§ˆëª¨ ì§„í–‰ì´ ì˜ˆì¸¡ë˜ì–´ ì²´ì¤‘ ê´€ë¦¬ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤.",
    "í—ˆë²…ì§€Â·ì—‰ë©ì´ ê·¼ìœ¡ ê°•í™”ê°€ í†µì¦ ê°ì†Œì— í•µì‹¬ì…ë‹ˆë‹¤.",
    "ìš´ë™ ì§í›„ 10ë¶„ ëƒ‰ì°œì§ˆ, í‰ì†Œ 15ë¶„ ì˜¨ì°œì§ˆì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
    "30~40ë¶„ë§ˆë‹¤ 2~3ë¶„ ê°€ë³ê²Œ ê±·ê¸°(ì¥ì‹œê°„ ì•‰ì•„ìˆê¸° ê¸ˆì§€).",
    "ì¿ ì…˜ì´ ì¢‹ì€ ìš´ë™í™” + ë‚´ì¸¡ì§€ì§€ ê¹”ì°½ì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
    "ë³´ì¡°ì ìœ¼ë¡œ MSMÂ·ì˜¤ë©”ê°€3Â·ë¹„íƒ€ë¯¼ D/K2 ì„­ì·¨ê°€ ë„ì›€ë©ë‹ˆë‹¤.",
    "ì¦ìƒ ì¦ê°€ ì‹œ ì˜ìƒê²€ì‚¬(X-ray/ì´ˆìŒíŒŒ) ë° ì „ë¬¸ì¹˜ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤."
  ],
  "í˜ˆì•• ê´€ë¦¬":[
    "í˜ˆì•• ë³€ë™ì„±ì´ ì»¤ ê´€ë¦¬ê°€ í•„ìš”í•œ ë‹¨ê³„ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.",
    "ë‘í†µÂ·ì–´ì§€ëŸ¬ì›€Â·ê°€ìŠ´ ë‹µë‹µí•¨ ë™ë°˜ ì‹œ ì¦‰ì‹œ ì§„ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤.",
    "ì—¼ë¶„Â·ì•¼ì‹Â·ê°€ê³µì‹í’ˆì„ ì¤„ì´ê³  ìˆ˜ë¶„ ì„­ì·¨ë¥¼ ê·œì¹™ì ìœ¼ë¡œ ìœ ì§€í•˜ì„¸ìš”.",
    "í•˜ë£¨ 30ë¶„ ê±·ê¸°Â·ê·¼ë ¥ìš´ë™ ë³‘í–‰ì´ í˜ˆì•• ì•ˆì •ì— íš¨ê³¼ì ì…ë‹ˆë‹¤.",
    "ìˆ˜ë©´ ë¶€ì¡±ê³¼ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í˜ˆì•• ìƒìŠ¹ì— í° ì˜í–¥ì„ ì¤ë‹ˆë‹¤.",
    "ìê¸° ì „ ìŠ¤ë§ˆíŠ¸í°Â·ì¹´í˜ì¸ì„ ì¤„ì´ê³  ì¼ì •í•œ ìˆ˜ë©´ì‹œê°„ì„ ìœ ì§€í•˜ì„¸ìš”.",
    "ì•½ ë³µìš© ì¤‘ì´ë¼ë©´ ì‹œê°„Â·ìš©ëŸ‰ì„ ëŠ˜ ë™ì¼í•˜ê²Œ ì§€í‚¤ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
    "ì§‘ì—ì„œëŠ” ì•„ì¹¨/ì €ë… 2íšŒ, 1ì£¼ ê¸°ë¡ì„ ìœ ì§€í•´ ì˜ì‚¬ì™€ ìƒì˜í•˜ì„¸ìš”.",
    "ì˜¤ë©”ê°€3Â·ì½”íí… ë“±ì€ ë³´ì¡°ì ìœ¼ë¡œ ë„ì›€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "ê°‘ì‘ìŠ¤ëŸ¬ìš´ í‰í†µÂ·í˜¸í¡ê³¤ë€ ì‹œ 119/ì‘ê¸‰ì‹¤ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
  ]
};

/* ë³´í—˜ ì œíœ´ ìƒ˜í”Œ */
const insuranceByTopic={
  "í˜ˆì•• ê´€ë¦¬":[
    {title:"ì‹¬ë‡Œí˜ˆê´€ ì§‘ì¤‘ ë³´ì¥",link:"#",desc:"ë‡Œì¶œí˜ˆÂ·ê¸‰ì„±ì‹¬ê·¼ê²½ìƒ‰ íŠ¹ì•½ ë¹„êµ"},
    {title:"ë§Œì„±ì§ˆí™˜ ì‹¤ì† ì—…ê·¸ë ˆì´ë“œ",link:"#",desc:"ê³ í˜ˆì•• ë™ë°˜ììš© íŠ¹ì•½ êµ¬ì¡°"}
  ],
  "ê´€ì ˆ í†µì¦":[
    {title:"ì •í˜•ì™¸ ì‹¤ì†/ì…ì› íŠ¹í™” ë¹„êµ",link:"#",desc:"ê´€ì ˆÂ·ë¬¼ë¦¬ì¹˜ë£Œ ë³´ì¥ í•­ëª© ì¤‘ì  ë¹„êµ"},
    {title:"ë…¸í›„ ì‹¤ì† í”Œëœ",link:"#",desc:"ìë¶€ë‹´ ìµœì†Œí™”í˜• ì„ íƒì§€ ì•ˆë‚´"}
  ]
};

(async function render(){
  let summary=[],opinion="";
  try{
    const analysis=await fetch("analysis.json").then(r=>r.json());
    const a=analysis[TOPIC];if(a){summary=a.summary||[];opinion=a.opinion||"";}
  }catch(e){}
  const detailLines=detailTemplates[TOPIC]||["í˜„ì¬ ìƒíƒœ í•´ì„ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.","ì¶”ê°€ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤."];
  document.getElementById("detail").innerHTML=detailLines.join("<br>");
  document.getElementById("summary").innerHTML=(summary.length?summary:[
    "í˜„ì¬ ìƒíƒœì— ëŒ€í•œ ê¸°ë³¸ ê°€ì´ë“œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.",
    "ì¶”ê°€ ê²€ì§„ ë° ìƒí™œ ê´€ë¦¬ ê³„íšì„ ìˆ˜ë¦½í•˜ì„¸ìš”."
  ]).map(s=>`<li>${s}</li>`).join("");
  document.getElementById("opinion").textContent=opinion||"ê°œì¸ ìƒí™©ì— ë§ëŠ” ì„¸ë¶€ ê³„íšì€ ì „ë¬¸ì˜ ìƒë‹´ í›„ ê²°ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
  let {percent,color}=riskConfig[TOPIC]||{percent:60,color:"#2f6efc"};
  if(payload&&payload.severity){
    const sev=String(payload.severity);
    if(sev.includes("ë†’"))percent=Math.max(percent,80);
    else if(sev.includes("ì¤‘"))percent=Math.max(percent,65);
    else percent=Math.min(percent,55);
  }
  const ctx=document.getElementById("riskChart");
  new Chart(ctx,{
    type:"doughnut",
    data:{datasets:[{data:[percent,100-percent],backgroundColor:[color,"#e5e7eb"],borderWidth:0}]},
    options:{
      cutout:"75%",
      plugins:{
        legend:{display:false},
        tooltip:{enabled:false},
        title:{display:true,text:`ìœ„í—˜ë„ ${percent}%`,color:"#1e3a8a",font:{size:18,weight:"bold"},position:"center"}
      }
    }
  });

  try{
    const aff=await fetch("affiliate.json").then(r=>r.json());
    const list=aff[TOPIC]||[];
    const wrap=document.getElementById("affList");
    wrap.innerHTML=list.map(item=>{
      const img=item.img||`https://via.placeholder.com/600x380.png?text=${encodeURIComponent(item.title)}`;
      return `<div class="card">
        <img src="${img}" alt="${item.title}">
        <a href="${item.link}" target="_blank">${item.title}</a>
        <div class="desc">${item.desc||""}</div>
      </div>`;
    }).join("")||`<div class="card"><div class="desc">ì¤€ë¹„ëœ ì œíœ´ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
  }catch(e){
    document.getElementById("affList").innerHTML=`<div class="card"><div class="desc">affiliate.json ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div></div>`;
  }

  const ins=insuranceByTopic[TOPIC]||[];
  document.getElementById("insList").innerHTML=ins.map(x=>`
    <div class="card"><a href="${x.link}" target="_blank">${x.title}</a><div class="desc">${x.desc||""}</div></div>
  `).join("")||`<div class="card"><div class="desc">ë³´í—˜ ì œíœ´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
})();
</script>

</body>
</html>
