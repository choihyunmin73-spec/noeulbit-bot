<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>노을빛하루 AI 진단 결과</title>
  <style>
    body {
      font-family: "Pretendard", sans-serif;
      background-color: #0b0f1a;
      color: #e5e7eb;
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      color: #91b4ff;
      margin-top: 30px;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 25px;
      padding: 40px;
      flex-wrap: wrap;
    }
    .panel {
      background-color: #161b26;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 0 10px #111827;
    }
    .left-panel {
      flex: 1 1 600px;
      max-width: 700px;
    }
    .right-panel {
      flex: 1 1 350px;
      max-width: 400px;
    }
    .section-title {
      font-size: 1.1em;
      color: #ffffff;
      margin-top: 25px;
      margin-bottom: 10px;
      border-left: 4px solid #3b82f6;
      padding-left: 10px;
    }
    .progress-bar {
      height: 10px;
      background-color: #1f2937;
      border-radius: 5px;
      margin: 10px 0;
    }
    .progress {
      height: 10px;
      background-color: #3b82f6;
      border-radius: 5px;
      width: 0%;
      transition: width 1s ease-in-out;
    }
    .affiliate-item, .insurance-item {
      background-color: #1f2532;
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .affiliate-item img, .insurance-item img {
      width: 55px;
      height: 55px;
      border-radius: 6px;
      object-fit: cover;
    }
    .affiliate-item a, .insurance-item a {
      color: #93c5fd;
      font-size: 0.9em;
      text-decoration: none;
    }
    .affiliate-item a:hover, .insurance-item a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>노을빛하루 AI 진단 결과</h1>
  <div class="container">
    <!-- Left Panel -->
    <div class="panel left-panel" id="resultPanel">
      <h2 id="topicTitle">주제명 불러오는 중...</h2>
      <p id="severity">진단 단계: -</p>
      <div class="progress-bar"><div class="progress" id="riskProgress"></div></div>
      <p id="riskScore">위험도 지표: -</p>

      <div class="section-title">상세 진단</div>
      <p id="detail"></p>

      <div class="section-title">요약</div>
      <p id="summary"></p>

      <div class="section-title">전문가 의견</div>
      <p id="expert"></p>
    </div>

    <!-- Right Panel -->
    <div class="panel right-panel">
      <div class="section-title">제휴상품 (필요하신 영양제)</div>
      <div id="affiliateList"></div>

      <div class="section-title">제휴보험 (체크해 보세요)</div>
      <div id="insuranceList"></div>
    </div>
  </div>

  <script>
    const topic = localStorage.getItem("selectedTopic") || "혈압 관리";

    async function loadResult() {
      try {
        const [analysisRes, affiliateRes] = await Promise.all([
          fetch("analysis.json"),
          fetch("affiliate.json")
        ]);
        const analysisData = await analysisRes.json();
        const affiliateData = await affiliateRes.json();

        const data = analysisData[topic];
        if (!data) {
          document.getElementById("resultPanel").innerHTML =
            "<p>결과 데이터를 찾을 수 없습니다.</p>";
          return;
        }

        // 좌측 데이터
        document.getElementById("topicTitle").textContent = topic;
        document.getElementById("severity").textContent = `${data.stage || "경미함"} 단계`;
        document.getElementById("riskScore").textContent = `위험도 지표: ${data.risk || "0"}/100`;
        document.getElementById("detail").textContent = data.detail || "상세 진단 데이터 없음";
        document.getElementById("summary").textContent = data.summary || "요약 데이터 없음";
        document.getElementById("expert").textContent = data.expert || "전문가 의견 데이터 없음";
        document.getElementById("riskProgress").style.width = `${data.risk || 0}%`;

        // 우측 제휴상품
        const affiliateList = affiliateData[topic]?.products || [];
        const affiliateContainer = document.getElementById("affiliateList");
        affiliateList.slice(0, 3).forEach(p => {
          const div = document.createElement("div");
          div.className = "affiliate-item";
          div.innerHTML = `
            <img src="${p.image}" alt="${p.name}">
            <div>
              <strong>${p.name}</strong><br>
              <a href="${p.link}" target="_blank">${p.desc}</a>
            </div>`;
          affiliateContainer.appendChild(div);
        });

        // 우측 제휴보험
        const insuranceList = affiliateData[topic]?.insurance || [];
        const insuranceContainer = document.getElementById("insuranceList");
        insuranceList.slice(0, 2).forEach(i => {
          const div = document.createElement("div");
          div.className = "insurance-item";
          div.innerHTML = `
            <img src="${i.image}" alt="${i.name}">
            <div>
              <strong>${i.name}</strong><br>
              <a href="${i.link}" target="_blank">${i.desc}</a>
            </div>`;
          insuranceContainer.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        document.getElementById("resultPanel").innerHTML = "<p>데이터 로드 중 오류가 발생했습니다.</p>";
      }
    }

    loadResult();
  </script>
</body>
</html>
