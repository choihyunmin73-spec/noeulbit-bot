<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 진단 결과</title>
    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 20px;
            padding: 30px;
        }
        .left, .right {
            background-color: #1e293b;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .left {
            width: 65%;
        }
        .right {
            width: 30%;
        }
        h2 {
            color: #60a5fa;
        }
        .metric-box {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        .metric {
            background-color: #334155;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 15px;
        }
        .progress-bar {
            background-color: #334155;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
            margin: 8px 0 16px 0;
        }
        .progress {
            background-color: #60a5fa;
            height: 100%;
            width: 0%;
            transition: width 1s ease-in-out;
        }
        ul {
            padding-left: 20px;
        }
        button {
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            margin: 8px 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2563eb;
        }
        .affiliate-box, .insurance-box {
            background-color: #1e293b;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .affiliate-box h3, .insurance-box h3 {
            color: #93c5fd;
            border-bottom: 1px solid #334155;
            padding-bottom: 6px;
            margin-bottom: 10px;
        }
        .affiliate-item {
            display: flex;
            align-items: flex-start;
            background-color: #334155;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .affiliate-item div {
            margin-left: 10px;
        }
        .affiliate-item strong {
            color: #fbbf24;
        }
        .affiliate-item a {
            color: #93c5fd;
            text-decoration: none;
            font-size: 13px;
        }
        .affiliate-item a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left">
            <h2>AI 진단 결과</h2>
            <p><strong>주제:</strong> <span id="topic">-</span></p>
            <div class="metric-box">
                <div class="metric">총 응답 수: <span id="answerCount">0</span>개</div>
                <div class="metric">위험단어 수: <span id="riskCount">0</span>개</div>
                <div class="metric">위험도 지표: <span id="riskScore">0</span>/100 (<span id="riskLevel">-</span>)</div>
            </div>
            <div class="progress-bar"><div class="progress" id="progressBar"></div></div>

            <h3>상세 진단</h3>
            <ul id="detail"></ul>

            <h3>요약</h3>
            <ul id="summary"></ul>

            <h3>전문가 의견</h3>
            <ul id="opinion"></ul>

            <div>
                <button onclick="goHome()">처음으로 돌아가기</button>
                <button onclick="redo()">다시 진단하기</button>
            </div>
        </div>

        <div class="right">
            <div class="affiliate-box">
                <h3>제휴상품 (필요하신 영양제)</h3>
                <div id="affiliateList"></div>
            </div>
            <div class="insurance-box">
                <h3>제휴보험 (체크해 보세요)</h3>
                <div id="insuranceList"></div>
            </div>
        </div>
    </div>

<script>
const result = JSON.parse(localStorage.getItem("aiResult") || "{}");
const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");
const topic = result.topic || "알 수 없음";
document.getElementById("topic").textContent = topic;

// 기본 수치 표시
document.getElementById("answerCount").textContent = answers.length;
document.getElementById("riskCount").textContent = result.riskWords?.length || 0;
document.getElementById("riskScore").textContent = result.riskScore || 0;
document.getElementById("riskLevel").textContent = result.level || "Mild";
document.getElementById("progressBar").style.width = (result.riskScore || 0) + "%";
function goHome() {
    window.location.href = "index.html";
}
function redo() {
    window.location.href = "question.html";
}

/* ✅ 빈 응답 대응 기본 진단 생성 */
function generateBaseDiagnosis(topic, level = "Mild") {
    const adviceTemplates = [
        "현재 상태는 비교적 안정적입니다. 생활 습관을 규칙적으로 유지하세요.",
        "스트레스와 수면의 질을 관리하면 도움이 됩니다.",
        "규칙적인 식사와 충분한 수분 섭취가 필요합니다.",
        "가벼운 스트레칭과 산책으로 몸의 순환을 돕습니다.",
        "건강검진을 정기적으로 확인하시기 바랍니다.",
        "지속되는 불편감이 있다면 전문의 상담을 권장합니다.",
        "흡연과 음주를 피하고, 카페인 섭취를 줄이세요.",
        "균형 잡힌 식단이 전반적 건강에 도움이 됩니다.",
        "만성 피로감이 있으면 충분한 휴식을 취하세요.",
        "체온, 맥박, 혈압 변화를 꾸준히 관찰하세요.",
        "생활 패턴이 일정하지 않다면 수면 시간을 일정하게 조정하세요.",
        "가벼운 통증이나 불편감은 휴식과 스트레칭으로 완화해 보세요.",
        "과로를 피하고, 하루 7시간 이상 숙면을 취하세요.",
        "걱정되는 증상이 있으면 2~3일 내 의료기관 상담을 권합니다.",
        "현재 상태는 안정적이며 경과 관찰을 병행하시기 바랍니다."
    ];

    const selected = adviceTemplates.slice(0, 15);
    return selected;
}

/* ✅ 실제 로직 */
const detailList = document.getElementById("detail");
const summaryList = document.getElementById("summary");
const opinionList = document.getElementById("opinion");

let detailLines = [];
let summaryLines = [];
let opinionLines = [];

// 응답이 있을 경우
if (answers.length > 0) {
    detailLines = [
        "현재 주제는 \"" + topic + "\"입니다.",
        "응답 결과를 분석한 결과, 위험도 수준은 " + (result.level || "Mild") + "로 판단됩니다.",
        "현재 상태는 비교적 안정적이며, 생활습관 개선으로 호전이 기대됩니다.",
        "규칙적인 수면과 영양 섭취가 필요합니다.",
        "스트레스 관리가 중요하며, 무리한 활동은 피하세요.",
        "필요 시 전문의 상담을 통해 정확한 검진을 권장합니다.",
        "증상이 지속되거나 악화될 경우 조기 진료가 필요합니다.",
        "수분 섭취를 늘리고, 자극적인 음식은 줄이세요.",
        "심한 피로나 통증이 반복된다면 병원 내원 권장드립니다.",
        "생활 패턴을 일정하게 유지하는 것이 좋습니다.",
        "적정 체중과 혈압을 유지하는 것이 예방에 도움이 됩니다.",
        "운동 전후 충분한 스트레칭으로 근육을 풀어주세요.",
        "불안하거나 수면의 질이 떨어진다면 전문상담을 고려하세요.",
        "의심되는 증상이 나타나면 1주일 내 진료를 권합니다.",
        "지속적인 관찰과 일상 관리가 중요합니다."
    ];

    summaryLines = [
        "주제: " + topic,
        "현재 위험 수준: " + (result.level || "Mild"),
        "응답 기반으로 비교적 안정적인 상태로 판단됩니다.",
        "생활습관 관리 및 규칙적인 루틴 유지가 필요합니다.",
        "정기검진을 통한 건강상태 확인을 권장합니다.",
        "필요 시 전문의 상담으로 추가 확인 바랍니다.",
        "생활 전반의 균형 유지가 건강에 도움이 됩니다."
    ];

    opinionLines = [
        "응답 분석 결과, 위험 징후는 낮지만 생활습관 점검이 필요합니다.",
        "전문의 상담을 병행하면 더 안정적인 개선이 기대됩니다."
    ];
} else {
    // 응답이 없을 경우 기본 진단 자동 생성
    detailLines = generateBaseDiagnosis(topic, result.level || "Mild");
    summaryLines = [
        "주제: " + topic,
        "응답 데이터 부족으로 일반 진단으로 대체되었습니다.",
        "현재 상태는 안정적이며 특별한 위험 신호는 없습니다.",
        "기본 생활습관 개선으로 건강을 유지하세요.",
        "불편감 지속 시 3일 내 내원 또는 전문상담을 권장합니다.",
        "정기적인 건강검진으로 예방 관리를 이어가세요.",
        "스트레스 관리와 충분한 수면이 도움이 됩니다."
    ];
    opinionLines = [
        "응답 부족 상태에서도 경미한 위험 징후는 없습니다.",
        "현재 건강상태를 유지하며 주기적 점검을 권장드립니다."
    ];
}

// 출력
detailLines.forEach(l => {
    const li = document.createElement("li");
    li.textContent = l;
    detailList.appendChild(li);
});
summaryLines.forEach(l => {
    const li = document.createElement("li");
    li.textContent = l;
    summaryList.appendChild(li);
});
opinionLines.forEach(l => {
    const li = document.createElement("li");
    li.textContent = l;
    opinionList.appendChild(li);
});

/* ✅ 제휴상품 표시 */
fetch("affiliate.json")
    .then(res => res.json())
    .then(data => {
        const affList = document.getElementById("affiliateList");
        const insList = document.getElementById("insuranceList");
        const affItems = data[topic] || [];
        const insItems = data["보험공통"] || [];

        affItems.forEach(item => {
            const div = document.createElement("div");
            div.className = "affiliate-item";
            div.innerHTML = `
                <img src="https://cdn-icons-png.flaticon.com/512/2936/2936737.png" width="30">
                <div>
                    <strong>${item.name}</strong><br>
                    ${item.desc}<br>
                    <a href="${item.link}" target="_blank">쿠팡 바로가기</a>
                </div>`;
            affList.appendChild(div);
        });

        insItems.forEach(item => {
            const div = document.createElement("div");
            div.className = "affiliate-item";
            div.innerHTML = `
                <img src="https://cdn-icons-png.flaticon.com/512/2830/2830281.png" width="28">
                <div>
                    <strong>${item.name}</strong><br>
                    ${item.desc}
                </div>`;
            insList.appendChild(div);
        });
    })
    .catch(() => {
        document.getElementById("affiliateList").innerHTML = "제휴 데이터 불러오기 실패";
    });
</script>
</body>
</html>
