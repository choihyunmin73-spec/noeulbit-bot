<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ë…¸ì„ë¹›í•˜ë£¨ AI ì§„ë‹¨ ê²°ê³¼</title>
<style>
  :root{
    --bg:#0d1420;--panel:#121a26;--panel2:#182235;--line:#2a3a55;--brand:#6ba7ff;--muted:#9fb1cf;--white:#fff;
  }
  body{font-family:"Pretendard","Noto Sans KR",sans-serif;background:var(--bg);color:var(--white);margin:0}
  h1{margin:26px 0 8px;text-align:center;color:var(--brand)}
  .wrap{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;padding:0 20px 40px}
  .card{background:var(--panel);border-radius:14px;box-shadow:0 0 12px rgba(0,0,0,.35);padding:20px;min-width:380px;max-width:860px;flex:2}
  .side{background:var(--panel);border-radius:14px;box-shadow:0 0 12px rgba(0,0,0,.35);padding:20px;min-width:360px;max-width:520px;flex:1}
  .title{display:flex;align-items:center;gap:8px;font-size:20px;margin:0 0 8px}
  .kpi{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 8px}
  .chip{background:var(--panel2);border:1px solid var(--line);border-radius:10px;padding:10px 12px;min-width:160px}
  .bar{height:8px;border-radius:4px;background:#22324b;overflow:hidden;margin:8px 0 18px}
  .bar>span{display:block;height:100%;width:0;background:var(--brand);transition:width .6s}
  .section{color:var(--brand);margin:18px 0 8px;border-left:3px solid var(--brand);padding-left:8px}
  .muted{color:var(--muted)}
  ul{margin:6px 0 10px 18px}
  li{margin:4px 0}
  .btns{display:flex;gap:10px;margin-top:16px}
  .btn{background:#213250;border:1px solid var(--line);color:#d7e6ff;padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn:hover{background:#2b416a}
  .pill{display:flex;gap:12px;flex-direction:column}
  .aff{display:flex;gap:12px;background:var(--panel2);border:1px solid var(--line);border-radius:12px;padding:14px;cursor:pointer;transition:.2s}
  .aff:hover{transform:translateY(-2px);background:#1e2a40}
  .aff .ic{font-size:20px}
  .ins{display:flex;gap:12px;align-items:flex-start;background:var(--panel2);border:1px solid var(--line);border-radius:12px;padding:14px;margin-bottom:12px}
  .w100{width:100%}
  @media (max-width:980px){.card{min-width:340px}}
</style>
</head>
<body>
  <h1>AI ì§„ë‹¨ ê²°ê³¼</h1>

  <div class="wrap">
    <!-- LEFT -->
    <section class="card" id="left">
      <div class="title">
        <span class="muted">ì£¼ì œ:</span>
        <strong id="topicTxt">ì•Œ ìˆ˜ ì—†ìŒ</strong>
      </div>

      <div class="kpi">
        <div class="chip"><div class="muted">ì´ ì‘ë‹µ ìˆ˜</div><div id="ansCount">0ê°œ</div></div>
        <div class="chip"><div class="muted">ìœ„í—˜ë‹¨ì–´ ìˆ˜</div><div id="riskWords">0ê°œ</div></div>
        <div class="chip w100">
          <div class="muted">ìœ„í—˜ë„ ì§€í‘œ</div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div id="riskScore">0/100</div><div id="riskLevel" class="muted">Mild</div>
          </div>
          <div class="bar"><span id="riskBar"></span></div>
        </div>
      </div>

      <h3 class="section">ìƒì„¸ ì§„ë‹¨</h3>
      <ul id="detailUL"><li class="muted">ìƒì„¸ ì§„ë‹¨ ë°ì´í„°ë¥¼ êµ¬ì„± ì¤‘...</li></ul>

      <h3 class="section">ìš”ì•½</h3>
      <ul id="summaryUL"><li class="muted">ìš”ì•½ ë°ì´í„°ë¥¼ êµ¬ì„± ì¤‘...</li></ul>

      <h3 class="section">ì „ë¬¸ê°€ ì˜ê²¬</h3>
      <ul id="opinionUL"><li class="muted">ì „ë¬¸ê°€ ì˜ê²¬ ë°ì´í„°ë¥¼ êµ¬ì„± ì¤‘...</li></ul>

      <div class="btns">
        <button class="btn" onclick="location.href='index.html'">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        <button class="btn" onclick="location.href='question.html?topic='+encodeURIComponent(topic)">ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</button>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="side">
      <h3 class="title">ì œíœ´ìƒí’ˆ (í•„ìš”í•˜ì‹  ì˜ì–‘ì œ)</h3>
      <div id="supps" class="pill"></div>

      <h3 class="section">ì œíœ´ë³´í—˜ (ì²´í¬í•´ ë³´ì„¸ìš”)</h3>
      <div id="ins">
        <!-- ë³´í—˜ 2ì¢… ê³ ì • -->
      </div>
    </aside>
  </div>

<script>
/* =========================
   0) ê³µìš© ë„ìš°ë¯¸
========================= */
const $ = (id)=>document.getElementById(id);
const topic = localStorage.getItem("aiTopic") || (JSON.parse(localStorage.getItem("aiResult")||"{}").topic) || "ì•Œ ìˆ˜ ì—†ìŒ";
const answers = JSON.parse(localStorage.getItem("aiAnswers") || "[]");

// ê¸°ì¡´ aiResultê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜, ìƒì„¸/ìš”ì•½/ì˜ê²¬ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±
const storedResult = JSON.parse(localStorage.getItem("aiResult") || "null");

/* =========================
   1) ìœ„í—˜ë„ ê³„ì‚°
========================= */
function calcRisk(answers, topic){
  const risky = [
    "ì‹¬í•¨","ë§¤ìš°","ë¶ˆê°€ëŠ¥","ìˆ¨","í˜¸í¡","ê°€ìŠ´","ì €ë¦¼","ë‘ê·¼","ë¶€ì •ë§¥","ì•¼ê°„","í•­ìƒ",
    "ê³ í˜ˆì••","ë†’ìŒ","ìœ„í—˜","í†µì¦","ìˆ˜ë©´ ë°©í•´","ëŠê¹€","í˜ˆë‹¹","ì–´ì§€ëŸ¼","ì‹¤ì‹ ","ê¸‰ê²©","ì—´ê°"
  ];
  let hits = 0;
  answers.forEach(a=>{
    risky.forEach(r=>{ if((a+"").includes(r)) hits++; });
  });
  // í† í”½ ê°€ì¤‘ì¹˜ (ì‹¬ì¥/í˜¸í¡/ê°€ìŠ´í†µì¦ì€ ë” ë¯¼ê°)
  const weight = /ì‹¬ì¥|í˜¸í¡|ê°€ìŠ´/.test(topic) ? 14 : 10;
  let score = Math.min(100, hits*weight);
  const level = score>=75 ? "Critical" : score>=50 ? "High" : score>=25 ? "Moderate" : "Mild";
  return {hits, score, level};
}

/* =========================
   2) ìƒì„¸/ìš”ì•½/ì˜ê²¬ ìƒì„±ê¸°
========================= */
function hospitalAdviceBy(level){
  if(level==="Critical") return "ì‹¬í•œ ì¦ìƒì— í•´ë‹¹í•©ë‹ˆë‹¤. 24â€“48ì‹œê°„ ì´ë‚´ì— ë³‘ì›(ì‘ê¸‰ í¬í•¨) ë°©ë¬¸ì„ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤.";
  if(level==="High")     return "ì¦ìƒì´ ëšœë ·í•©ë‹ˆë‹¤. 1ì£¼ ì´ë‚´ì— í•´ë‹¹ ì§„ë£Œê³¼ ì „ë¬¸ì˜ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.";
  if(level==="Moderate") return "ê´€ì°°ì´ í•„ìš”í•©ë‹ˆë‹¤. 2â€“4ì£¼ ë‚´ì— ì™¸ë˜ ìƒë‹´ì„ ê³ ë ¤í•˜ì„¸ìš”.";
  return "í˜„ì¬ ìƒíƒœëŠ” ë¹„êµì  ì–‘í˜¸í•©ë‹ˆë‹¤. ìƒí™œ ìŠµê´€ì„ ìœ ì§€í•˜ê³  ê²½ê³¼ë¥¼ ê´€ì°°í•˜ì„¸ìš”.";
}

function topicTips(topic){
  // ê° ì£¼ì œë³„ë¡œ í•µì‹¬ ê´€ë¦¬ í¬ì¸íŠ¸ (5~7ì¤„)
  switch(true){
    case /ì–´ê¹¨Â·ëª©/.test(topic):
      return [
        "ì¥ì‹œê°„ ì•‰ì•„ ìˆì„ ê²½ìš° 30â€“60ë¶„ë§ˆë‹¤ ê¸°ì§€ê°œ ë° ìŠ¹ëª¨ê·¼ ìŠ¤íŠ¸ë ˆì¹­ì„ í•´ì£¼ì„¸ìš”.",
        "ì‘ì—…ëŒ€Â·ì˜ì ë†’ì´ë¥¼ ì¡°ì ˆí•´ ì–´ê¹¨ê°€ ë“¤ë¦¬ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.",
        "ì˜¨ì°œì§ˆ 10~15ë¶„ìœ¼ë¡œ ê·¼ìœ¡ ê¸´ì¥ì„ ì™„í™”í•˜ì„¸ìš”.",
        "ìˆ˜ë©´ ì‹œ ë² ê°œ ë†’ì´ëŠ” ëª©ì´ ìˆ˜í‰ì„ ì´ë£¨ë„ë¡ ë§ì¶¥ë‹ˆë‹¤.",
        "í†µì¦ì´ ì €ë¦¼ì„ ë™ë°˜í•˜ê±°ë‚˜ ì•¼ê°„ ì•…í™” ì‹œ ì§„ë£Œë¥¼ ê³ ë ¤í•˜ì„¸ìš”.",
        "ê°€ë²¼ìš´ ê·¼ë ¥ìš´ë™(ë°´ë“œ, ë²½ ë°€ê¸°)ìœ¼ë¡œ ì¬ë°œì„ ì˜ˆë°©í•©ë‹ˆë‹¤.",
        "ì§„í†µì†Œì—¼ì œ/íŒŒìŠ¤ëŠ” ë‹¨ê¸°ê°„ ë³´ì¡° ìˆ˜ë‹¨ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”."
      ];
    case /ì‹¬ì¥|í˜¸í¡|ê°€ìŠ´/.test(topic):
      return [
        "ê°€ìŠ´ í†µì¦ì´ 10ë¶„ ì´ìƒ ì§€ì†ë˜ê±°ë‚˜ ì‹ì€ë•€, ë©”ìŠ¤êº¼ì›€ì´ ë™ë°˜ë˜ë©´ ì¦‰ì‹œ ì§„ë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤.",
        "í‰ì†Œ í˜ˆì••Â·ë§¥ë°•ì„ ì£¼ê¸°ì ìœ¼ë¡œ ê¸°ë¡í•˜ì„¸ìš”.",
        "ê²©ë ¬í•œ í™œë™ ì „í›„ë¡œ ìˆ¨ì°¸Â·ì–´ì§€ëŸ¼ì´ ë°˜ë³µë˜ë©´ ê²€ì‚¬ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.",
        "í¡ì—°ì€ ì‹¬í˜ˆê´€ ìœ„í—˜ì„ í¬ê²Œ ë†’ì´ë¯€ë¡œ ì¤‘ë‹¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
        "ì§  ìŒì‹Â·ì•¼ì‹ ë¹ˆë„ë¥¼ ì¤„ì´ê³ , í¬í™”ì§€ë°© ì„­ì·¨ë¥¼ ì œí•œí•©ë‹ˆë‹¤.",
        "ì£¼ 3~5íšŒ 30ë¶„ ê±·ê¸° ë“± ìœ ì‚°ì†Œ ìš´ë™ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
        "ìƒˆë¡œìš´ ì•½ ë³µìš© í›„ ì‹¬ê³„í•­ì§„ì´ ìƒê¸°ë©´ ì²˜ë°©ì˜ì™€ ìƒë‹´í•˜ì„¸ìš”."
      ];
    case /í˜ˆì••/.test(topic):
      return [
        "ì§‘ì—ì„œ ì•„ì¹¨/ì €ë… ê°™ì€ ì‹œê°„ëŒ€ì— í˜ˆì••ì„ ì¸¡ì •í•´ ê¸°ë¡í•˜ì„¸ìš”.",
        "ë‚˜íŠ¸ë¥¨ ì„­ì·¨ë¥¼ ì¤„ì´ê³  ê°€ê³µì‹í’ˆÂ·êµ­ë¬¼ ì„­ì·¨ë¥¼ ì¤„ì…ë‹ˆë‹¤.",
        "ì²´ì¤‘ 5~10% ê°ëŸ‰ë§Œìœ¼ë¡œë„ í˜ˆì••ì´ ìœ ì˜ë¯¸í•˜ê²Œ ê°œì„ ë©ë‹ˆë‹¤.",
        "ê·œì¹™ì ì¸ ìœ ì‚°ì†Œ ìš´ë™ì„ ì£¼ 150ë¶„ ì´ìƒ ìœ ì§€í•˜ì„¸ìš”.",
        "ë³µì•½ì€ ê±´ë„ˆë›°ì§€ ë§ê³ , ë¶€ì‘ìš©ì€ ì˜ì‚¬ì™€ ìƒì˜í•˜ì„¸ìš”.",
        "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬(í˜¸í¡, ëª…ìƒ, ìˆ˜ë©´)ë¡œ ë³€ë™í­ì„ ì¤„ì…ë‹ˆë‹¤.",
        "ë‘í†µÂ·í‰í†µÂ·ì‹œì•¼íë¦¼ ë™ë°˜ ì‹œ ì¦‰ì‹œ ì§„ë£Œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤."
      ];
    case /í˜ˆë‹¹|ë‹¹ë‡¨/.test(topic):
      return [
        "ì‹í›„ 2ì‹œê°„ í˜ˆë‹¹ì„ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸í•´ ì‹ì‚¬ ë°˜ì‘ì„ ì ê²€í•˜ì„¸ìš”.",
        "ì •ì œ íƒ„ìˆ˜í™”ë¬¼Â·ë‹¹ë¥˜ ì„­ì·¨ë¥¼ ì¤„ì´ê³  ë‹¨ë°±ì§ˆì„ ë³´ê°•í•©ë‹ˆë‹¤.",
        "í•˜ë£¨ ì´ ê±¸ìŒ ìˆ˜ë¥¼ ëŠ˜ë ¤ ì‹í›„ í˜ˆë‹¹ ìƒìŠ¹ì„ ì™„í™”í•˜ì„¸ìš”.",
        "ì²´ì¤‘Â·í—ˆë¦¬ë‘˜ë ˆ ë³€í™”ë¥¼ ê¸°ë¡í•˜ë©° ìƒí™œ íš¨ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.",
        "ë°œ ì €ë¦¼/ìƒì²˜ê°€ ì˜ ë‚«ì§€ ì•Šìœ¼ë©´ ë°˜ë“œì‹œ ì§„ë£Œë¥¼ ë°›ìœ¼ì„¸ìš”.",
        "ìˆ˜ë¶„ ì„­ì·¨ì™€ ìˆ™ë©´ì€ í˜ˆë‹¹ ë³€ë™ ì™„í™”ì— ì¤‘ìš”í•©ë‹ˆë‹¤.",
        "ì•½ ë³µìš© ì¤‘ ì €í˜ˆë‹¹ ì¦ìƒ ì‹œ ì¦‰ì‹œ ì¡°ì¹˜ í›„ ìƒë‹´í•˜ì„¸ìš”."
      ];
    case /ë¶ˆë©´|ìˆ˜ë©´/.test(topic):
      return [
        "ì·¨ì¹¨ 2ì‹œê°„ ì „ ì¹´í˜ì¸Â·ìŒì£¼Â·ê³¼ì‹ì€ í”¼í•˜ì„¸ìš”.",
        "ë§¤ì¼ ê°™ì€ ì‹œê°„ì— ëˆ•ê³  ì¼ì–´ë‚˜ëŠ” ë¦¬ë“¬ì„ ìœ ì§€í•©ë‹ˆë‹¤.",
        "ì¹¨ì‹¤ì€ ì–´ë‘¡ê³  ì¡°ìš©í•˜ë©° ì„œëŠ˜í•˜ê²Œ ìœ ì§€í•˜ì„¸ìš”.",
        "ì¹¨ëŒ€ì—ì„œëŠ” ì ê³¼ íœ´ì‹ë§Œâ€”ìŠ¤ë§ˆíŠ¸í°/TV ì‚¬ìš©ì„ ì¤„ì…ë‹ˆë‹¤.",
        "30ë¶„ ë„˜ê²Œ ë’¤ì²™ì´ë©´ ì¼ì–´ë‚˜ ê°€ë²¼ìš´ í™œë™ í›„ ë‹¤ì‹œ ëˆ„ìš°ì„¸ìš”.",
        "ë‚®ì ì€ 20ë¶„ ì´ë‚´, ëŠ¦ì€ ì˜¤í›„ ë‚®ì ì€ í”¼í•©ë‹ˆë‹¤.",
        "ì½”ê³¨ì´Â·ë¬´í˜¸í¡ ì˜ì‹¬ ì‹œ ìˆ˜ë©´ í´ë¦¬ë‹‰ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤."
      ];
    case /ë…¸ì•ˆ|ì‹œë ¥/.test(topic):
      return [
        "ê·¼ê±°ë¦¬ ì‘ì—…ì€ 20ë¶„ë§ˆë‹¤ 20ì´ˆ ë™ì•ˆ 6m ì´ìƒ ë¨¼ ê³³ì„ ë´…ë‹ˆë‹¤(20-20-20).",
        "ì¡°ëª… ë°˜ì‚¬Â·ëˆˆë¶€ì‹¬ì„ ì¤„ì´ê³ , í™”ë©´ ë°ê¸°ë¥¼ ì£¼ë³€ê³¼ ë§ì¶¥ë‹ˆë‹¤.",
        "ì¸ê³µëˆˆë¬¼ì„ ì´ìš©í•´ ê±´ì¡°ê°ì„ ì™„í™”í•˜ì„¸ìš”.",
        "ì •ê¸°ì ì¸ ì‹œë ¥ê²€ì§„ìœ¼ë¡œ êµì •ë„ìˆ˜/ë°±ë‚´ì¥ ì§„í–‰ì„ í™•ì¸í•˜ì„¸ìš”.",
        "ì•¼ê°„ ìš´ì „ ì‹œ ëˆˆë¶€ì‹¬ ì‹¬í•˜ë©´ ì§„ë£Œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.",
        "í•­ì‚°í™” ì‹í’ˆ(ì±„ì†ŒÂ·ê³¼ì¼)ê³¼ ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ê°€ ë„ì›€ë©ë‹ˆë‹¤.",
        "ê°‘ì‘ìŠ¤ëŸ° ë²ˆê°œ ëª¨ì–‘Â·ì‹œì•¼ ê²°ì†ì€ ì‘ê¸‰ ì¦ìƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      ];
    case /ê´€ì ˆ/.test(topic):
      return [
        "í†µì¦ì´ ì—†ëŠ” ë²”ìœ„ì—ì„œ ê´€ì ˆ ê°€ë™ìš´ë™ì„ ë§¤ì¼ ì‹¤ì‹œí•˜ì„¸ìš”.",
        "ê³„ë‹¨Â·ìª¼ê·¸ë ¤ ì•‰ê¸° ë“± ë¬´ë¦ ë¶€í•˜ ìì„¸ë¥¼ ì¤„ì…ë‹ˆë‹¤.",
        "ì²´ì¤‘ ê°ëŸ‰ì€ ê´€ì ˆ í•˜ì¤‘ì„ í¬ê²Œ ë‚®ì¶¥ë‹ˆë‹¤.",
        "ëƒ‰/ì˜¨ì°œì§ˆì„ í†µì¦ ë‹¨ê³„ì— ë§ê²Œ ë³‘í–‰í•˜ì„¸ìš”.",
        "ê´€ì ˆ ì£¼ë³€ ê·¼ë ¥(ëŒ€í‡´ì‚¬ë‘, ë‘”ê·¼)ì„ ê°•í™”í•©ë‹ˆë‹¤.",
        "ë¶€ì¢…Â·ì—´ê°ì´ ì§€ì†ë˜ë©´ ì—¼ì¦ì„± ì§ˆí™˜ ê°ë³„ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "ë³´ì¡°ê¸°Â·ì‹ ë°œ ê¹”ì°½ì€ ì „ë¬¸ ìƒë‹´ í›„ ì‚¬ìš©í•˜ì„¸ìš”."
      ];
    default:
      return [
        "í˜„ì¬ ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ì „ë°˜ ìƒíƒœë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.",
        "ìœ„í—˜ ì‹ í˜¸ê°€ ìƒˆë¡œ ìƒê¸°ë©´ ì¦‰ì‹œ ì˜ë£Œ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
        "ìƒí™œ ìŠµê´€(ì‹ì‚¬Â·ìˆ˜ë©´Â·ìš´ë™)ì„ ê·œì¹™ì ìœ¼ë¡œ ìœ ì§€í•˜ì„¸ìš”.",
        "ì¦ìƒ ì¼ì§€ë¥¼ ê¸°ë¡í•˜ë©´ ë³€í™” ì¶”ì ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.",
        "ë³µì•½/ì˜ì–‘ì œëŠ” ê³¼ìš©ì„ í”¼í•˜ê³  ìƒí˜¸ì‘ìš©ì„ í™•ì¸í•˜ì„¸ìš”.",
        "ì •ê¸° ê²€ì§„ìœ¼ë¡œ ê¸°ì € ìœ„í—˜ìš”ì¸ì„ ê´€ë¦¬í•˜ì„¸ìš”.",
        "ê¸´ê¸‰ ì¦ìƒ(ì‹¤ì‹ , í˜¸í¡ê³¤ë€, í‰í†µ)ì€ ì§€ì²´ ì—†ì´ 119/ì‘ê¸‰ì‹¤ ì´ìš©."
      ];
  }
}

function buildDetail(topic, answers, level){
  const lines = [];
  lines.push(`ì„ íƒ ì£¼ì œëŠ” â€œ${topic}â€ì´ë©°, ì œì¶œí•˜ì‹  ì‘ë‹µì„ ë°”íƒ•ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ í•´ì„í–ˆìŠµë‹ˆë‹¤.`);
  lines.push(hospitalAdviceBy(level));
  // ë‹µë³€ ë°˜ì˜(ìˆì„ ë•Œë§Œ 3~5ì¤„)
  if(answers.length){
    const show = answers.slice(0,5);
    show.forEach((a,i)=>lines.push(`ì‘ë‹µ ${i+1}: â€œ${a}â€ í•­ëª©ì„ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.`));
  }else{
    lines.push("ì‘ë‹µì´ ì—†ì–´ ê¸°ë³¸ ì•ˆì „ ìˆ˜ì¹™ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤.");
  }
  // ì£¼ì œë³„ íŒ
  lines.push(...topicTips(topic));
  // ê²½ê³  ì‹ í˜¸
  lines.push("ì•„ë˜ â€˜ê²½ê³  ì‹ í˜¸â€™ê°€ ìƒˆë¡œ ë°œìƒ/ì•…í™”ë˜ë©´ ì¦‰ì‹œ ì§„ë£Œí•˜ì„¸ìš”: ê°‘ì‘ìŠ¤ëŸ° ê·¹ì‹¬í•œ í†µì¦, í˜¸í¡ê³¤ë€, í‰í†µ, ë°˜ë³µë˜ëŠ” ì‹¤ì‹ /ì–´ì§€ëŸ¼.");
  // 15ì¤„ í™•ë³´
  while(lines.length<15) lines.push("ìƒí™œê´€ë¦¬ì™€ ê²½ê³¼ ê´€ì°°ì„ ë³‘í–‰í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.");
  return lines.slice(0,15);
}

function buildSummary(topic, level){
  const base = [
    `ì£¼ì œ: ${topic}`,
    `ìœ„í—˜ë„ ìˆ˜ì¤€: ${level}`,
    hospitalAdviceBy(level),
    "ê°€ì • ê´€ë¦¬: ìˆ˜ë©´Â·ìš´ë™Â·ì‹ì‚¬ ê· í˜• ìœ ì§€",
    "ì¦ìƒ ë³€í™” ê¸°ë¡(ë°œí˜„ ì‹œê°„/ìœ ë°œ ìš”ì¸)",
    "ê²½ê³  ì‹ í˜¸ ë°œìƒ ì‹œ ì¦‰ì‹œ ì§„ë£Œ",
    "ì •ê¸° ê²€ì§„ ë° ê¸°ì €ì§ˆí™˜ ë™ë°˜ ê´€ë¦¬"
  ];
  return base.slice(0,7);
}

function buildOpinion(topic, level){
  if(level==="Critical") return [
    "ì‘ê¸‰ ì¦ìƒ ë°°ì œë¥¼ ìœ„í•œ ì‹ ì†í•œ ê²€ì‚¬(ì‹¬ì „ë„/í˜ˆì•¡ ë“±)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.",
    "ì¦ìƒ ì•ˆì • ì „ê¹Œì§€ ë¬´ë¦¬í•œ í™œë™ê³¼ ìš´ì „ì„ í”¼í•˜ì„¸ìš”."
  ];
  if(level==="High") return [
    "ì›ì¸ ê°ë³„(ê·¼ê³¨ê²©/ì‹ ê²½/ì‹¬í˜ˆê´€ ë“±)ì„ ìœ„í•œ ì „ë¬¸ ì§„ë£Œ ì˜ˆì•½ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
    "ìƒí™œìš”ë²•ì„ ë³‘í–‰í•˜ë©´ì„œ ì•…í™” ìš”ì¸(ìˆ˜ë©´ë¶€ì¡±, ê³¼ë¡œ, ì—¼ë¶„ê³¼ë‹¤)ì„ ì¤„ì´ì„¸ìš”."
  ];
  return [
    "ìê°€ ê´€ë¦¬ ì¤‘ì‹¬ìœ¼ë¡œ ê²½ê³¼ë¥¼ ë³´ë˜ ìƒˆë¡œìš´ ê²½ê³  ì‹ í˜¸ì— ìœ ì˜í•˜ì„¸ìš”.",
    "í•„ìš” ì‹œ ê¸°ë³¸ ê²€ì§„ê³¼ ìƒí™œì§€ë„(ìš´ë™Â·ìì„¸Â·ì˜ì–‘)ë¥¼ ì ê²€í•˜ì„¸ìš”."
  ];
}

/* =========================
   3) ë Œë”ë§
========================= */
function render(){
  $("topicTxt").textContent = topic;

  let ans = answers;
  // í˜¹ì‹œ ì„œë²„/ì´ì „ ë‹¨ê³„ì—ì„œ ì™„ì„±ëœ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë°˜ì˜
  let detail = [], summary=[], opinion=[], riskScore=0, riskLevel="Mild", hits=0;

  if(storedResult){
    ans = storedResult.answers || ans;
    const calc = calcRisk(ans, topic);
    riskScore = storedResult.riskPercent ?? calc.score;
    riskLevel = storedResult.level || calc.level;
    hits = storedResult.riskHits ?? calc.hits;
    detail  = (storedResult.detail && Array.isArray(storedResult.detail)) ? storedResult.detail
             : (storedResult.detail ? [storedResult.detail] : []);
    summary = Array.isArray(storedResult.summary) ? storedResult.summary : [];
    opinion = Array.isArray(storedResult.opinion||storedResult.advice) ? (storedResult.opinion||storedResult.advice) : [];
  }else{
    const calc = calcRisk(ans, topic);
    riskScore = calc.score; riskLevel = calc.level; hits = calc.hits;
  }

  // ìë™ ìƒì„± ë³´ê°•
  if(detail.length < 5)  detail  = buildDetail(topic, ans, riskLevel);
  if(summary.length < 7) summary = buildSummary(topic, riskLevel);
  if(opinion.length < 2) opinion = buildOpinion(topic, riskLevel);

  // ìˆ«ì/ë°”
  $("ansCount").textContent  = (ans.length||0)+"ê°œ";
  $("riskWords").textContent = (hits||0)+"ê°œ";
  $("riskScore").textContent = (riskScore||0)+"/100";
  $("riskLevel").textContent = riskLevel;
  $("riskBar").style.width   = Math.max(0, Math.min(100, riskScore)) + "%";

  // ìƒì„¸ 15ì¤„
  $("detailUL").innerHTML = detail.map(t=>`<li>${t}</li>`).join("");

  // ìš”ì•½ 7ì¤„
  $("summaryUL").innerHTML = summary.map(t=>`<li>${t}</li>`).join("");

  // ì „ë¬¸ê°€ ì˜ê²¬ 2ì¤„
  $("opinionUL").innerHTML = opinion.map(t=>`<li>${t}</li>`).join("");

  // ì˜¤ë¥¸ìª½ ë³´í—˜(ê³ ì • 2ì¢…)
  const ins = $("ins");
  ins.innerHTML = "";
  [
    {name:"ê³ í˜ˆì••Â·ì‹¬ì¥ ë³´ì¥ë³´í—˜", desc:"í˜ˆì••Â·ì‹¬í˜ˆê´€ì§ˆí™˜ ì¤‘ì‹¬ ë³´ì¥ ìƒí’ˆ"},
    {name:"ë§Œì„±ì§ˆí™˜ ì‹¤ì†ë³´í—˜",   desc:"ì •ê¸° ë‚´ê³¼Â·ê²€ì‚¬ë¹„ ë³´ì¥ ìƒí’ˆ"}
  ].forEach(i=>{
    const d=document.createElement("div");
    d.className="ins";
    d.innerHTML=`<div class="ic">ğŸ›¡ï¸</div>
    <div><div><strong>${i.name}</strong></div><div class="muted">${i.desc}</div></div>`;
    ins.appendChild(d);
  });

  // ì˜¤ë¥¸ìª½ ì œíœ´ìƒí’ˆ: affiliate.json â†’ topic í‚¤
  fetch("/affiliate.json")
    .then(r=>r.json())
    .then(map=>{
      const supps=$("supps");
      supps.innerHTML="";
      const list = map[topic] || [];
      if(!list.length){
        supps.innerHTML = `<div class="muted">í•´ë‹¹ ì£¼ì œì— ë“±ë¡ëœ ì œíœ´ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }
      list.slice(0,3).forEach(item=>{
        const div=document.createElement("div");
        div.className="aff";
        div.innerHTML = `
          <div class="ic">ğŸ’Š</div>
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.desc||""}</div>
            <div class="muted">ì¿ íŒ¡ ë°”ë¡œê°€ê¸°</div>
          </div>`;
        div.onclick=()=>window.open(item.link,"_blank");
        supps.appendChild(div);
      });
    })
    .catch(()=>{
      $("supps").innerHTML = `<div class="muted">ì œíœ´ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>`;
    });

  // ìµœì¢… ê²°ê³¼ë¥¼ ë¡œì»¬ì— ë³´ê°• ì €ì¥(ìë™ ìƒì„± í¬í•¨)
  const finalPack = {
    topic,
    answers: ans,
    riskPercent: riskScore,
    level: riskLevel,
    riskHits: hits,
    detail,
    summary,
    opinion
  };
  localStorage.setItem("aiResult", JSON.stringify(finalPack));
}

render();
</script>
</body>
</html>
