<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>AI ë§ì¶¤ ì§„ë‹¨ | ë…¸ì„ë¹›í•˜ë£¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: "Noto Sans KR", sans-serif;
  background:#f3f6fb;
  margin:0;
  padding:0;
}
.header {
  text-align:center;
  background:#0f4fff;
  padding:22px;
  font-size:22px;
  color:white;
  font-weight:700;
}
.wrapper {
  max-width:650px;
  margin:35px auto;
  background:white;
  padding:28px;
  border-radius:15px;
  box-shadow:0 5px 18px rgba(0,0,0,0.12);
  transition: all 0.4s ease;
}
.question-title {
  font-size:22px;
  font-weight:700;
  margin-bottom:25px;
  line-height:1.5;
  color:#0f4fff;
  text-align:center;
}
.option {
  padding:16px;
  background:#eef3ff;
  margin:12px 0;
  border-radius:10px;
  cursor:pointer;
  font-size:18px;
  transition:0.25s;
  border:2px solid transparent;
}
.option:hover {
  background:#dce7ff;
  border-color:#0f4fff;
}
.option:active {
  background:#cbd9ff;
  transform:scale(0.98);
}
.progress {
  margin-top:25px;
  text-align:center;
  font-size:15px;
  color:#5b6472;
}
.loading-box {
  display:none;
  text-align:center;
  color:#444;
  font-size:17px;
  font-weight:500;
  padding:40px 10px;
  line-height:1.6;
}

/* ëª¨ë°”ì¼ ìµœì í™” */
@media (max-width:480px) {
  .header { font-size:20px; padding:18px; }
  .wrapper { margin:15px; padding:20px; }
  .question-title { font-size:19px; }
  .option { font-size:17px; padding:18px; }
  .progress { font-size:14px; }
}
</style>
</head>

<body>

<div class="header">AI ë§ì¶¤ ì§„ë‹¨</div>

<div class="wrapper" id="quiz-box">
  <div id="question-text" class="question-title"></div>
  <div id="options"></div>
  <div class="progress">
    <span id="progress-text">ë¬¸í•­ 1 / 8</span>
  </div>
</div>

<div class="loading-box" id="loading-box">
  ğŸ¤– AIê°€ ì…ë ¥í•˜ì‹  ì‘ë‹µì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.<br>
  ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...
</div>

<script>
/* âœ… ì „ë‹¬ëœ topic ë°›ê¸° */
const params = new URLSearchParams(window.location.search);
const topic = params.get("topic");

/* âœ… ë¬¸í•­ ë°ì´í„° ë¡œë“œ */
let surveyData;
fetch("/survey.json")
  .then(res => res.json())
  .then(data => {
    surveyData = data;
    startQuiz();
  })
  .catch(() => {
    document.getElementById("question-text").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
  });

/* âœ… ë™ì‘ ë³€ìˆ˜ */
let index = 0;
let selectedAnswers = [];
let questions = [];

/* âœ… ì£¼ì œë³„ ë¬¸í•­ ì‹œì‘ */
function startQuiz() {
  questions = surveyData[topic] || [];
  if (!questions.length) {
    document.getElementById("question-text").innerText = "ë¬¸í•­ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
    return;
  }
  loadQuestion();
}

/* âœ… ë¬¸í•­ ë¡œë”© */
function loadQuestion() {
  const q = questions[index];
  document.getElementById("question-text").innerText = q.q;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  q.opt.forEach(option => {
    const div = document.createElement("div");
    div.className = "option";
    div.innerText = option;

    div.onclick = () => {
      selectedAnswers.push(option);
      index++;

      if (index < questions.length) {
        document.querySelector(".wrapper").style.opacity = "0";
        setTimeout(() => {
          document.querySelector(".wrapper").style.opacity = "1";
          loadQuestion();
        }, 250);
      } else {
        submitAnswers();
      }
    };
    optionsDiv.appendChild(div);
  });
  document.getElementById("progress-text").innerText =
    `ë¬¸í•­ ${index + 1} / ${questions.length}`;
}

/* âœ… ê²°ê³¼ ì „ì†¡ */
function submitAnswers() {
  document.getElementById("quiz-box").style.display = "none";
  document.getElementById("loading-box").style.display = "block";

  fetch("/analyze", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ topic, checks: selectedAnswers })
  })
  .then(res => res.json())
  .then(data => {
    window.location.href = `/result?payload=${encodeURIComponent(JSON.stringify(data))}`;
  })
  .catch(() => {
    alert("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    window.location.href = "/result?error=true";
  });
}
</script>

</body>
</html>
